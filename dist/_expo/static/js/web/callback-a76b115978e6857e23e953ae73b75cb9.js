__d(function(g,r,i,a,m,_e,_d){"use strict";function e(e){if(e&&e.__esModule)return e;var o={};return e&&Object.keys(e).forEach(function(t){var s=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(o,t,s.get?s:{enumerable:!0,get:function(){return e[t]}})}),o.default=e,o}function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(_e,'__esModule',{value:!0}),Object.defineProperty(_e,"default",{enumerable:!0,get:function(){return T}});var t=r(_d[0]),s=e(r(_d[1])),n=e(r(_d[2])),l=e(r(_d[3])),c=r(_d[4]),u=r(_d[5]),d=o(r(_d[6])),h=o(r(_d[7])),f=o(r(_d[8])),p=r(_d[9]),O=r(_d[10]),A=r(_d[11]),k=r(_d[12]),b=r(_d[13]),S=r(_d[14]);function T(){const e=(0,c.useRouter)(),o=(0,k.useColors)(),f=(0,c.useLocalSearchParams)(),[T,y]=(0,u.useState)("processing"),[w,I]=(0,u.useState)(1),[U,v]=(0,u.useState)(null);return(0,u.useEffect)(()=>{(async()=>{console.log("[OAuth] Callback handler triggered"),console.log("[OAuth] Params received:",{code:f.code,state:f.state,error:f.error,sessionToken:f.sessionToken?"present":"missing",user:f.user?"present":"missing"});try{if(I(1),f.sessionToken){if(console.log("[OAuth] Session token found in params (web callback)"),I(2),await n.setSessionToken(f.sessionToken),f.user)try{const e="undefined"!=typeof atob?atob(f.user):Buffer.from(f.user,"base64").toString("utf-8"),o=JSON.parse(e),t={id:o.id,openId:o.openId,name:o.name,email:o.email,loginMethod:o.loginMethod,lastSignedIn:new Date(o.lastSignedIn||Date.now())};await n.setUserInfo(t),console.log("[OAuth] User info stored:",t),await(0,O.saveLoginSuccessPending)(t.name||void 0,o.profileImage)}catch(e){console.error("[OAuth] Failed to parse user data:",e)}return I(3),y("success"),console.log("[OAuth] Web authentication successful, redirecting to home..."),void setTimeout(()=>{e.replace("/(tabs)")},1500)}let o=null;if(f.code||f.state||f.error){console.log("[OAuth] Found params in route params");const e=new URLSearchParams;f.code&&e.set("code",f.code),f.state&&e.set("state",f.state),f.error&&e.set("error",f.error),o=`?${e.toString()}`,console.log("[OAuth] Constructed URL from params:",o)}else{console.log("[OAuth] No params found, checking Linking.getInitialURL()...");const e=await l.getInitialURL();console.log("[OAuth] Linking.getInitialURL():",e),e&&(o=e)}const t=f.error||(o?new URL(o,"http://dummy").searchParams.get("error"):null);if(t)return console.error("[OAuth] Error parameter found:",t),y("error"),void v(t||"OAuth error occurred");let c=null,u=null,d=null;if(f.code&&f.state)console.log("[OAuth] Using code and state from route params"),c=f.code,u=f.state;else if(o){console.log("[OAuth] Parsing code and state from URL:",o);try{const e=new URL(o);c=e.searchParams.get("code"),u=e.searchParams.get("state"),d=e.searchParams.get("sessionToken"),console.log("[OAuth] Extracted from URL:",{code:c?.substring(0,20)+"...",state:u?.substring(0,20)+"...",sessionToken:d?"present":"missing"})}catch(e){console.log("[OAuth] Failed to parse as full URL, trying regex:",e);const t=o.match(/[?&](code|state|sessionToken)=([^&]+)/g);t&&(t.forEach(e=>{const[o,t]=e.substring(1).split("=");"code"===o&&(c=decodeURIComponent(t)),"state"===o&&(u=decodeURIComponent(t)),"sessionToken"===o&&(d=decodeURIComponent(t))}),console.log("[OAuth] Extracted from regex:",{code:c?.substring(0,20)+"...",state:u?.substring(0,20)+"...",sessionToken:d?"present":"missing"}))}}if(console.log("[OAuth] Final extracted values:",{hasCode:!!c,hasState:!!u,hasSessionToken:!!d}),d)return console.log("[OAuth] Session token found in URL, storing..."),I(2),await n.setSessionToken(d),console.log("[OAuth] Session token stored successfully"),I(3),y("success"),console.log("[OAuth] Redirecting to home..."),void setTimeout(()=>{e.replace("/(tabs)")},1500);if(!c||!u)return console.error("[OAuth] Missing code or state parameter",{hasCode:!!c,hasState:!!u}),y("error"),void v("Missing code or state parameter");I(2),console.log("[OAuth] Exchanging code for session token...",{code:c.substring(0,20)+"...",state:u.substring(0,20)+"..."});const h=await s.exchangeOAuthCode(c,u);if(console.log("[OAuth] Exchange result:",{hasSessionToken:!!h.sessionToken,hasUser:!!h.user}),h.sessionToken){if(console.log("[OAuth] Session token received, storing..."),await n.setSessionToken(h.sessionToken),console.log("[OAuth] Session token stored successfully"),h.user){console.log("[OAuth] User data received:",h.user);const e={id:h.user.id,openId:h.user.openId,name:h.user.name,email:h.user.email,loginMethod:h.user.loginMethod,lastSignedIn:new Date(h.user.lastSignedIn||Date.now())};await n.setUserInfo(e),console.log("[OAuth] User info stored:",e),await(0,O.saveLoginSuccessPending)(e.name||void 0,h.user.profileImage)}else console.log("[OAuth] No user data in result");I(3),y("success"),console.log("[OAuth] Authentication successful, redirecting to home..."),setTimeout(()=>{console.log("[OAuth] Executing redirect..."),e.replace("/(tabs)")},1500)}else console.error("[OAuth] No session token in result:",h),y("error"),v("No session token received")}catch(e){console.error("[OAuth] Callback error:",e),y("error"),v(e instanceof Error?e.message:"Failed to complete authentication")}})()},[f.code,f.state,f.error,f.sessionToken,f.user,e]),"error"===T?(0,S.jsx)(p.SafeAreaView,{style:{flex:1,backgroundColor:o.background},edges:["top","bottom","left","right"],children:(0,S.jsxs)(h.default,{style:x.errorContainer,children:[(0,S.jsx)(A.Image,{source:r(_d[15]),style:x.logo,contentFit:"contain"}),(0,S.jsx)(b.BlinkingLink,{variant:"halfClosed",size:150,blinkInterval:3e3}),(0,S.jsx)(d.default,{style:[x.errorTitle,{color:o.error}],children:"\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f"}),(0,S.jsx)(d.default,{style:[x.errorMessage,{color:o.muted}],children:"access_denied"===U?"\u8a8d\u8a3c\u304c\u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u307e\u3057\u305f":U||"\u8a8d\u8a3c\u306b\u5931\u6557\u3057\u307e\u3057\u305f"}),(0,S.jsx)(d.default,{style:[x.hint,{color:o.muted}],children:"\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044"})]})}):(0,S.jsx)(p.SafeAreaView,{style:{flex:1},edges:["top","bottom","left","right"],children:(0,S.jsx)(t.LoginLoadingScreen,{currentStep:w})})}const x=f.default.create({errorContainer:{flex:1,alignItems:"center",justifyContent:"center",padding:24},logo:{width:64,height:64,marginBottom:16},errorTitle:{fontSize:20,fontWeight:"bold",marginTop:24,marginBottom:8},errorMessage:{fontSize:14,textAlign:"center",marginBottom:16},hint:{fontSize:12,textAlign:"center",position:"absolute",bottom:40,left:24,right:24}})},1592,[1593,1186,1181,642,473,3,188,109,28,1642,1406,1056,728,1253,2,1594]);
__d(function(g,r,i,a,m,_e,d){"use strict";function e(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(_e,'__esModule',{value:!0}),Object.defineProperty(_e,"default",{enumerable:!0,get:function(){return v}}),_e.LoginLoadingScreen=j;var t=r(d[0]),n=r(d[1]),o=e(r(d[2])),s=e(r(d[3])),l=e(r(d[4])),u=e(r(d[5])),c=e(r(d[6])),f=r(d[7]),h=r(d[8]),p=r(d[9]),b=r(d[10]);const y=[{id:1,title:"Twitter\u8a8d\u8a3c\u4e2d...",subtitle:"Twitter\u306b\u63a5\u7d9a\u3057\u3066\u3044\u307e\u3059",icon:"\ud83d\udc26"},{id:2,title:"\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u53d6\u5f97\u4e2d...",subtitle:"\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059",icon:"\ud83d\udc64"},{id:3,title:"\u6e96\u5099\u5b8c\u4e86\uff01",subtitle:"\u307e\u3082\u306a\u304f\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059",icon:"\u2728"}],x=["\u3082\u3046\u5c11\u3057\u3060\u3088\u301c\uff01","Twitter\u8a8d\u8a3c\u4e2d\u3060\u3088\uff01","\u5f85\u3063\u3066\u3066\u306d\u301c\u266a","\u30ed\u30b0\u30a4\u30f3\u51e6\u7406\u4e2d...\uff01","\u3042\u3068\u5c11\u3057\uff01","\u6e96\u5099\u3057\u3066\u308b\u3088\u301c"];function j(e){const l=(0,t.c)(72),{currentStep:j,message:v}=e,w=void 0===j?1:j,_=(0,h.useColors)(),[T,B]=(0,n.useState)(0);let I;l[0]===Symbol.for("react.memo_cache_sentinel")?(I=new u.default.Value(0),l[0]=I):I=l[0];const[V]=(0,n.useState)(I);let R;l[1]===Symbol.for("react.memo_cache_sentinel")?(R=new u.default.Value(1),l[1]=R):R=l[1];const[k]=(0,n.useState)(R);let z;l[2]===Symbol.for("react.memo_cache_sentinel")?(z=new u.default.Value(0),l[2]=z):z=l[2];const[D]=(0,n.useState)(z);let O,W,L,M,N,E,A,q,P;l[3]!==V?(O=()=>{const e=u.default.loop(u.default.timing(V,{toValue:1,duration:2e3,easing:c.default.linear,useNativeDriver:!0}));return e.start(),()=>e.stop()},W=[V],l[3]=V,l[4]=O,l[5]=W):(O=l[4],W=l[5]),(0,n.useEffect)(O,W),l[6]!==k?(L=()=>{const e=u.default.loop(u.default.sequence([u.default.timing(k,{toValue:1.1,duration:800,easing:c.default.inOut(c.default.ease),useNativeDriver:!0}),u.default.timing(k,{toValue:1,duration:800,easing:c.default.inOut(c.default.ease),useNativeDriver:!0})]));return e.start(),()=>e.stop()},M=[k],l[6]=k,l[7]=L,l[8]=M):(L=l[7],M=l[8]),(0,n.useEffect)(L,M),l[9]!==D?(E=()=>{const e=u.default.loop(u.default.sequence([u.default.timing(D,{toValue:-10,duration:500,easing:c.default.inOut(c.default.ease),useNativeDriver:!0}),u.default.timing(D,{toValue:0,duration:500,easing:c.default.inOut(c.default.ease),useNativeDriver:!0})]));return e.start(),()=>e.stop()},N=[D],l[9]=D,l[10]=N,l[11]=E):(N=l[10],E=l[11]),(0,n.useEffect)(E,N),l[12]===Symbol.for("react.memo_cache_sentinel")?(A=()=>{const e=setInterval(()=>{B(C)},3e3);return()=>clearInterval(e)},q=[],l[12]=A,l[13]=q):(A=l[12],q=l[13]),(0,n.useEffect)(A,q),l[14]!==V?(P=V.interpolate({inputRange:[0,1],outputRange:["0deg","360deg"]}),l[14]=V,l[15]=P):P=l[15];const F=P;let H,Y,G,J,K,Q,U;Math.min(w-1,y.length-1),l[16]!==_.background?(H=[S.container,{backgroundColor:_.background}],l[16]=_.background,l[17]=H):H=l[17],l[18]===Symbol.for("react.memo_cache_sentinel")?(Y=(0,b.jsx)(o.default,{style:S.logoContainer,children:(0,b.jsx)(f.Image,{source:r(d[11]),style:S.logo,contentFit:"contain"})}),l[18]=Y):Y=l[18],l[19]!==D?(G=[S.characterContainer,{transform:[{translateY:D}]}],l[19]=D,l[20]=G):G=l[20],l[21]===Symbol.for("react.memo_cache_sentinel")?(J=(0,b.jsx)(p.BlinkingLink,{variant:"smileOpen",size:150,blinkInterval:2500}),l[21]=J):J=l[21],l[22]!==G?(K=(0,b.jsx)(u.default.View,{style:G,children:J}),l[22]=G,l[23]=K):K=l[23],l[24]!==_.surface?(Q=[S.speechBubble,{backgroundColor:_.surface}],l[24]=_.surface,l[25]=Q):Q=l[25],l[26]!==_.foreground?(U=[S.speechText,{color:_.foreground}],l[26]=_.foreground,l[27]=U):U=l[27];const X=x[T];let Z,$,ee,te,re,ne,oe,ie,ae,se,le,ue,de;return l[28]!==U||l[29]!==X?(Z=(0,b.jsx)(s.default,{style:U,children:X}),l[28]=U,l[29]=X,l[30]=Z):Z=l[30],l[31]!==_.surface?($=(0,b.jsx)(o.default,{style:[S.speechBubbleTail,{borderTopColor:_.surface}]}),l[31]=_.surface,l[32]=$):$=l[32],l[33]!==Q||l[34]!==Z||l[35]!==$?(ee=(0,b.jsxs)(o.default,{style:Q,children:[Z,$]}),l[33]=Q,l[34]=Z,l[35]=$,l[36]=ee):ee=l[36],l[37]!==F?(te=[S.spinnerContainer,{transform:[{rotate:F}]}],l[37]=F,l[38]=te):te=l[38],l[39]!==_.primary?(re=[S.spinner,{borderColor:_.primary}],l[39]=_.primary,l[40]=re):re=l[40],l[41]!==_.primary?(ne=(0,b.jsx)(o.default,{style:[S.spinnerDot,{backgroundColor:_.primary}]}),l[41]=_.primary,l[42]=ne):ne=l[42],l[43]!==re||l[44]!==ne?(oe=(0,b.jsx)(o.default,{style:re,children:ne}),l[43]=re,l[44]=ne,l[45]=oe):oe=l[45],l[46]!==te||l[47]!==oe?(ie=(0,b.jsx)(u.default.View,{style:te,children:oe}),l[46]=te,l[47]=oe,l[48]=ie):ie=l[48],l[49]!==_.foreground||l[50]!==_.muted||l[51]!==_.primary||l[52]!==_.success||l[53]!==_.surface||l[54]!==w||l[55]!==k?(ae=y.map((e,t)=>{const n=t+1===w,l=t+1<w;return(0,b.jsxs)(o.default,{style:S.stepRow,children:[(0,b.jsx)(u.default.View,{style:[S.stepIcon,{backgroundColor:l?_.success:n?_.primary:_.surface,transform:n?[{scale:k}]:[]}],children:(0,b.jsx)(s.default,{style:S.stepIconText,children:l?"\u2713":e.icon})}),(0,b.jsxs)(o.default,{style:S.stepTextContainer,children:[(0,b.jsx)(s.default,{style:[S.stepTitle,{color:n?_.foreground:l?_.success:_.muted,fontWeight:n?"bold":"normal"}],children:e.title}),n&&(0,b.jsx)(s.default,{style:[S.stepSubtitle,{color:_.muted}],children:e.subtitle})]})]},e.id)}),l[49]=_.foreground,l[50]=_.muted,l[51]=_.primary,l[52]=_.success,l[53]=_.surface,l[54]=w,l[55]=k,l[56]=ae):ae=l[56],l[57]!==ae?(se=(0,b.jsx)(o.default,{style:S.stepsContainer,children:ae}),l[57]=ae,l[58]=se):se=l[58],l[59]!==_.muted||l[60]!==v?(le=v&&(0,b.jsx)(s.default,{style:[S.customMessage,{color:_.muted}],children:v}),l[59]=_.muted,l[60]=v,l[61]=le):le=l[61],l[62]!==_.muted?(ue=(0,b.jsx)(s.default,{style:[S.hint,{color:_.muted}],children:"\u30ed\u30b0\u30a4\u30f3\u51e6\u7406\u306b\u306f\u5c11\u3057\u6642\u9593\u304c\u304b\u304b\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059"}),l[62]=_.muted,l[63]=ue):ue=l[63],l[64]!==H||l[65]!==K||l[66]!==ee||l[67]!==ie||l[68]!==se||l[69]!==le||l[70]!==ue?(de=(0,b.jsxs)(o.default,{style:H,children:[Y,K,ee,ie,se,le,ue]}),l[64]=H,l[65]=K,l[66]=ee,l[67]=ie,l[68]=se,l[69]=le,l[70]=ue,l[71]=de):de=l[71],de}function C(e){return(e+1)%x.length}const S=l.default.create({container:{flex:1,alignItems:"center",justifyContent:"center",padding:24},logoContainer:{marginBottom:16},logo:{width:64,height:64},characterContainer:{marginBottom:8},speechBubble:{paddingHorizontal:20,paddingVertical:12,borderRadius:20,marginBottom:24,position:"relative"},speechBubbleTail:{position:"absolute",bottom:-10,left:"50%",marginLeft:-10,width:0,height:0,borderLeftWidth:10,borderRightWidth:10,borderTopWidth:10,borderLeftColor:"transparent",borderRightColor:"transparent"},speechText:{fontSize:16,fontWeight:"600",textAlign:"center"},spinnerContainer:{marginBottom:32},spinner:{width:48,height:48,borderRadius:24,borderWidth:3,borderStyle:"dashed",alignItems:"center",justifyContent:"flex-start",paddingTop:4},spinnerDot:{width:8,height:8,borderRadius:4},stepsContainer:{width:"100%",maxWidth:300,marginBottom:24},stepRow:{flexDirection:"row",alignItems:"center",marginBottom:16},stepIcon:{width:40,height:40,borderRadius:20,alignItems:"center",justifyContent:"center",marginRight:12},stepIconText:{fontSize:18},stepTextContainer:{flex:1},stepTitle:{fontSize:14},stepSubtitle:{fontSize:12,marginTop:2},customMessage:{fontSize:14,textAlign:"center",marginBottom:16},hint:{fontSize:12,textAlign:"center",position:"absolute",bottom:40,left:24,right:24}});var v=j},1593,[1685,3,109,188,28,102,206,1056,728,1253,2,1594]);
__d(function(g,r,i,a,m,e,d){m.exports={uri:"/assets/assets/images/icon.05b99307dfa0a194f5681292efa4c106.png",width:300,height:457}},1594,[]);