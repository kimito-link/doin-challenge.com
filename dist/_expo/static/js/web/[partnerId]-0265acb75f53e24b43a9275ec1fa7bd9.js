__d(function(g,r,i,a,m,_e,_d){"use strict";function e(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(_e,'__esModule',{value:!0}),Object.defineProperty(_e,"default",{enumerable:!0,get:function(){return y}});var t=r(_d[0]),n=r(_d[1]),s=e(r(_d[2])),l=e(r(_d[3])),c=e(r(_d[4])),d=e(r(_d[5])),o=e(r(_d[6])),u=e(r(_d[7]));r(_d[8]);var f=r(_d[9]),x=r(_d[10]),h=r(_d[11]),b=r(_d[12]),p=((function(e){if(e&&e.__esModule)return e;var t={};e&&Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),t.default=e})(r(_d[13])),r(_d[14])),j=r(_d[15]);function y(){const e=(0,t.c)(60),{partnerId:y,challengeId:N}=(0,f.useLocalSearchParams)(),S=(0,f.useRouter)(),{user:w}=(0,b.useAuth)(),[I,v]=(0,n.useState)(""),P=(0,n.useRef)(null),C=parseInt(y||"0",10),k=parseInt(N||"0",10);let A;e[0]!==k||e[1]!==C?(A={partnerId:C,challengeId:k},e[0]=k,e[1]=C,e[2]=A):A=e[2];const E=!!w&&!!C&&!!k;let T;e[3]!==E?(T={enabled:E},e[3]=E,e[4]=T):T=e[4];const{data:O,refetch:M}=h.trpc.dm.getConversation.useQuery(A,T);let R;e[5]!==M?(R={onSuccess:()=>{v(""),M()}},e[5]=M,e[6]=R):R=e[6];const L=h.trpc.dm.send.useMutation(R),B=h.trpc.dm.markAllAsRead.useMutation();let U,D,V,z,F;e[7]!==B||e[8]!==C||e[9]!==w?(U=()=>{w&&C&&B.mutate({fromUserId:C})},e[7]=B,e[8]=C,e[9]=w,e[10]=U):U=e[10],e[11]!==C||e[12]!==w?(D=[w,C],e[11]=C,e[12]=w,e[13]=D):D=e[13],(0,n.useEffect)(U,D),e[14]!==O?(V=()=>{O&&O.length>0&&setTimeout(()=>{P.current?.scrollToEnd({animated:!0})},100)},z=[O],e[14]=O,e[15]=V,e[16]=z):(V=e[15],z=e[16]),(0,n.useEffect)(V,z),e[17]!==k||e[18]!==I||e[19]!==C||e[20]!==L||e[21]!==w?(F=async()=>{if(I.trim()&&w)try{await L.mutateAsync({toUserId:C,challengeId:k,message:I.trim()})}catch(e){const t=e;console.error("Failed to send message:",t)}},e[17]=k,e[18]=I,e[19]=C,e[20]=L,e[21]=w,e[22]=F):F=e[22];const G=F;if(!w){let t;return e[23]===Symbol.for("react.memo_cache_sentinel")?(t=(0,j.jsx)(x.ScreenContainer,{className:"p-6",children:(0,j.jsx)(s.default,{className:"flex-1 items-center justify-center",children:(0,j.jsx)(l.default,{className:"text-lg text-muted text-center",children:"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308b\u306b\u306f\u30ed\u30b0\u30a4\u30f3\u304c\u5fc5\u8981\u3067\u3059"})})}),e[23]=t):t=e[23],t}let H;e[24]!==w.id?(H=e=>{const{item:t}=e,n=t.fromUserId===w.id;return(0,j.jsx)(s.default,{className:"flex-row mb-3 "+(n?"justify-end":"justify-start"),children:(0,j.jsxs)(s.default,{className:"max-w-[75%] rounded-2xl px-4 py-3 "+(n?"bg-primary":"bg-surface"),children:[(0,j.jsx)(l.default,{className:"text-base "+(n?"text-background":"text-foreground"),children:t.message}),(0,j.jsx)(l.default,{className:"text-xs mt-1 "+(n?"text-background/70":"text-muted"),children:new Date(t.createdAt).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})})]})})},e[24]=w.id,e[25]=H):H=e[25];const J=H;let K,Q,$,q,W,X,Y,Z,ee,te,re;e[26]===Symbol.for("react.memo_cache_sentinel")?(K=["top","left","right"],e[26]=K):K=e[26],e[27]!==S?(Q=()=>S.back(),e[27]=S,e[28]=Q):Q=e[28],e[29]===Symbol.for("react.memo_cache_sentinel")?($=(0,j.jsx)(l.default,{className:"text-foreground",children:"\u2190 \u623b\u308b"}),e[29]=$):$=e[29],e[30]!==Q?(q=(0,j.jsx)(p.AppHeader,{title:"\u541b\u6597\u308a\u3093\u304f\u306e\u52d5\u54e1\u3061\u3083\u308c\u3093\u3058",showCharacters:!1,rightElement:(0,j.jsx)(o.default,{onPress:Q,className:"flex-row items-center",children:$})}),e[30]=Q,e[31]=q):q=e[31],e[32]===Symbol.for("react.memo_cache_sentinel")?(W=(0,j.jsx)(s.default,{className:"p-4 border-b border-border",children:(0,j.jsx)(l.default,{className:"text-lg font-bold text-foreground",children:"\u30e1\u30c3\u30bb\u30fc\u30b8"})}),e[32]=W):W=e[32],e[33]!==O?(X=O||[],e[33]=O,e[34]=X):X=e[34],e[35]===Symbol.for("react.memo_cache_sentinel")?(Y={padding:16,flexGrow:1},e[35]=Y):Y=e[35],e[36]===Symbol.for("react.memo_cache_sentinel")?(Z=(0,j.jsx)(s.default,{className:"flex-1 items-center justify-center",children:(0,j.jsx)(l.default,{className:"text-muted",children:"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u3063\u3066\u307f\u307e\u3057\u3087\u3046"})}),e[36]=Z):Z=e[36],e[37]!==J||e[38]!==X?(ee=(0,j.jsx)(c.default,{ref:P,data:X,renderItem:J,keyExtractor:_,contentContainerStyle:Y,showsVerticalScrollIndicator:!1,ListEmptyComponent:Z,windowSize:10,maxToRenderPerBatch:15,initialNumToRender:20,removeClippedSubviews:!1,updateCellsBatchingPeriod:50,inverted:!1}),e[37]=J,e[38]=X,e[39]=ee):ee=e[39],e[40]!==G||e[41]!==I?(te=(0,j.jsx)(d.default,{value:I,onChangeText:v,placeholder:"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b...",placeholderTextColor:"#9BA1A6",multiline:!0,maxLength:1e3,className:"flex-1 bg-surface rounded-2xl px-4 py-3 text-foreground mr-3 max-h-24",returnKeyType:"send",onSubmitEditing:G}),e[40]=G,e[41]=I,e[42]=te):te=e[42],e[43]!==I||e[44]!==L?(re=!I.trim()||L.isPending,e[43]=I,e[44]=L,e[45]=re):re=e[45];const ae="w-12 h-12 rounded-full items-center justify-center "+(I.trim()?"bg-primary":"bg-surface"),ne="text-xl "+(I.trim()?"text-background":"text-muted");let se,le,ce,de;return e[46]!==ne?(se=(0,j.jsx)(l.default,{className:ne,children:"\u2191"}),e[46]=ne,e[47]=se):se=e[47],e[48]!==G||e[49]!==re||e[50]!==ae||e[51]!==se?(le=(0,j.jsx)(o.default,{onPress:G,disabled:re,className:ae,children:se}),e[48]=G,e[49]=re,e[50]=ae,e[51]=se,e[52]=le):le=e[52],e[53]!==te||e[54]!==le?(ce=(0,j.jsxs)(s.default,{className:"flex-row items-end p-4 border-t border-border bg-background",children:[te,le]}),e[53]=te,e[54]=le,e[55]=ce):ce=e[55],e[56]!==q||e[57]!==ee||e[58]!==ce?(de=(0,j.jsx)(x.ScreenContainer,{edges:K,children:(0,j.jsxs)(u.default,{behavior:"height",className:"flex-1",keyboardVerticalOffset:0,children:[q,W,ee,ce]})}),e[56]=q,e[57]=ee,e[58]=ce,e[59]=de):de=e[59],de}function _(e){return`${e.id}`}},1587,[1685,3,109,188,107,252,229,234,104,473,1083,1087,1185,708,1210,2]);