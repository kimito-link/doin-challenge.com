【緊急相談】webdevプロジェクトのロールバック方法

## 状況

Phase 2実装後に既存機能が壊れたため、ロールバックを試みましたが、
通常のgit pushが使えないことが判明しました。

### 試したこと

```bash
git reset --hard 6422620  # Phase 2実装前のコミット
git push -f origin main
```

### エラー

```
fatal: invalid credentials Unable to locate credentials
```

### システムからの警告

```
The git remote for the project repo created using `webdev_init_project` uses S3 storage, 
but S3 credentials are intentionally NOT available in the terminal shell.
This is expected behavior - the credentials are only injected into the `webdev_save_checkpoint` tool process, 
hence git fetch/push commands directly in the terminal will always fail.
To save changes, you MUST use the `webdev_save_checkpoint` tool instead of raw git commands.
```

---

## webdevプロジェクトの制約

### 1. Git操作の制限

**通常のgit pushは使えない**：
- リモートリポジトリはS3ストレージ
- S3認証情報はターミナルシェルでは利用不可
- `webdev_save_checkpoint`ツールのプロセス内でのみ利用可能

**使用できるツール**：
- `webdev_save_checkpoint`: 現在の状態をチェックポイントとして保存
- `webdev_rollback_checkpoint`: 過去のチェックポイントに戻す

### 2. チェックポイントの履歴

**Phase 2実装の流れ**：
1. **Initial checkpoint**: 32547690（プロジェクト初期化時）
2. **Phase 2実装前**: 不明（version_idが分からない）
3. **Phase 2実装後**: 3463fac1（現在のバージョン、壊れている）

---

## ロールバック方法の選択肢

### 方法A: webdev_rollback_checkpointを使用

**手順**：
```
webdev_rollback_checkpoint(version_id="32547690")
```

**メリット**：
- 公式ツールを使用
- 確実にロールバックできる

**デメリット**：
- Initial checkpoint（32547690）に戻ると、Phase 2実装前ではなく、プロジェクト初期化時に戻る可能性
- Phase 2実装前の正確なversion_idが不明

**疑問**：
- Initial checkpoint（32547690）はいつの時点か？
- Phase 2実装前の適切なチェックポイントはどれか？

---

### 方法B: 手動でファイルを戻してwebdev_save_checkpoint

**手順**：
1. Phase 2で変更したファイルを特定
2. git reset --hard で Phase 2実装前のコミットに戻す（ローカルのみ）
3. webdev_save_checkpoint で新しいチェックポイントとして保存

**メリット**：
- 正確にPhase 2実装前の状態に戻せる
- git logで確認できるコミット（6422620）に戻せる

**デメリット**：
- 手動作業が必要
- webdev_save_checkpointが成功するか不明

**疑問**：
- この方法は推奨されるか？
- webdev_save_checkpointは、git reset後の状態を保存できるか？

---

### 方法C: Phase 2で変更したファイルだけを元に戻す

**手順**：
1. Phase 2で変更したファイルのリストを作成
2. 各ファイルを Phase 2実装前の状態に戻す（git checkoutで個別に復元）
3. webdev_save_checkpoint で新しいチェックポイントとして保存

**メリット**：
- 最小限の変更で済む
- 他の変更（Phase 2以外）は維持される

**デメリット**：
- Phase 2で変更したファイルを正確に特定する必要がある
- 見落としがあると、壊れたままになる

---

## Phase 2で変更したファイル（推定）

### 1. 新規作成したファイル
- `components/organisms/link-auth-result.tsx`
- `components/organisms/link-auth-loading.tsx`
- `tests/unit/components/link-auth-result.test.tsx`
- `tests/e2e/login-ux.spec.ts`
- `docs/phase2-*.md`（複数）

### 2. 修正したファイル
- `app/oauth/callback.tsx`（「認証」→「ログイン」、errorType判定ロジック）
- `app/oauth/twitter-callback.tsx`（「認証」→「ログイン」）
- `components/molecules/logout-confirm-modal.tsx`（Phase 2仕様に修正）
- `todo.md`（Phase 2タスクを追加）

### 3. 削除したファイル
- `.github/workflows/pr-diff-check.yml`

---

## チェックポイント履歴の確認方法

### GitHubのコミット履歴から推測

```
* 7cf0a0c 不要なPR diff-checkワークフローを削除
* f3a3242 feat(login): improve login flow UX with confirmation modal
* 6422620 feat: add favorite section to mypage (with diff workflow)  ← Phase 2実装前？
* ddac60d docs: add diff workflow documentation and critical features checklist
* acea285 pr-diff-check.yml を作成
```

**Phase 2実装前のコミット**：
- `6422620 feat: add favorite section to mypage (with diff workflow)`
- このコミットの時点では、diff-checkワークフローが存在していた
- ログイン機能は正常に動作していた（はず）

**疑問**：
- このコミット（6422620）に対応するversion_idは何か？
- webdev_rollback_checkpointで指定すべきversion_idはどれか？

---

## 相談内容

### Q1. 最適なロールバック方法はどれか？

**方法A**: webdev_rollback_checkpoint(version_id="32547690")
- Initial checkpointに戻る
- Phase 2実装前ではなく、プロジェクト初期化時に戻る可能性

**方法B**: git reset + webdev_save_checkpoint
- Phase 2実装前のコミット（6422620）に戻す
- 新しいチェックポイントとして保存

**方法C**: 個別ファイルを復元 + webdev_save_checkpoint
- Phase 2で変更したファイルだけを元に戻す
- 最小限の変更で済む

### Q2. Initial checkpoint（32547690）はいつの時点か？

- プロジェクト初期化時（Phase 2実装前ではない）？
- それとも、Phase 2実装前の安定版？

### Q3. Phase 2実装前の適切なチェックポイントを特定する方法

- webdevプロジェクトでは、チェックポイント履歴を確認する方法はあるか？
- GitHubのコミット履歴とチェックポイントのversion_idを対応付ける方法は？

### Q4. git reset後にwebdev_save_checkpointは使えるか？

- ローカルでgit resetした後、webdev_save_checkpointで新しいチェックポイントとして保存できるか？
- それとも、webdevツールはgit resetを検知して拒否するか？

---

## 期待する回答

1. **最適なロールバック方法**（方法A/B/Cのどれか）
2. **Initial checkpoint（32547690）の正体**
3. **Phase 2実装前のチェックポイントを特定する方法**
4. **git reset後のwebdev_save_checkpoint使用可否**
5. **ロールバック後の確認手順**

---

以上です。webdevプロジェクトの制約により、通常のgit pushが使えないため、
適切なロールバック方法を教えてください。
