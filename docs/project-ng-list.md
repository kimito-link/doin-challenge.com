# プロジェクト全体のNG集（触ってはいけないファイル・パターン）

## 目次

1. [OAuth/認証関連](#oauth認証関連)
2. [データベーススキーマ](#データベーススキーマ)
3. [サーバーコア機能](#サーバーコア機能)
4. [グローバル設定](#グローバル設定)
5. [ビルド・デプロイ設定](#ビルドデプロイ設定)
6. [禁止ワード](#禁止ワード)

---

## OAuth/認証関連

### 触ってはいけないファイル

```
server/routes/auth.ts
server/routes/oauth-callback.ts
app/oauth/callback.tsx
lib/auth-context.tsx
hooks/use-auth.ts
```

### 理由

- **OAuth 2.0フローは複雑で壊れやすい**
  - PKCE、state、code_verifierなどの暗号化パラメータが絡む
  - 一箇所でも間違えるとログインが完全に壊れる
- **Twitter API仕様変更に依存**
  - 独自の修正が将来の仕様変更で動かなくなる可能性
- **セキュリティリスク**
  - 認証周りのバグはセキュリティホールに直結

### 例外

- **新しいログインUX（画面・文言）の追加**: OK
  - ただし、OAuth処理自体は触らない
  - `useAuth()`フックの戻り値を使うだけ

---

## データベーススキーマ

### 触ってはいけないファイル

```
drizzle/schema/*.ts
drizzle/migrations/*.sql
server/db/*.ts
```

### 理由

- **既存データが壊れる可能性**
  - カラム削除・型変更は既存データを破壊
  - マイグレーションの失敗でデータベース全体が使えなくなる
- **依存関係の連鎖**
  - テーブル構造の変更は全APIに影響
  - フロントエンドの型定義も全て変更が必要

### 例外

- **新しいテーブルの追加**: OK（既存テーブルに影響しない）
- **新しいカラムの追加**: OK（`ALTER TABLE ADD COLUMN`）
- **カラムの削除・型変更**: NG（マイグレーション計画が必要）

---

## サーバーコア機能

### 触ってはいけないファイル

```
server/_core/index.ts
server/_core/trpc.ts
server/_core/middleware.ts
```

### 理由

- **サーバー全体の起動に影響**
  - 一箇所でもエラーがあるとサーバーが起動しない
  - 全API・全機能が使えなくなる
- **ミドルウェアの順序が重要**
  - 認証・CORS・エラーハンドリングの順序を間違えると動かない

### 例外

- **新しいAPIルートの追加**: OK（`server/routes/`に追加）
- **既存APIの修正**: OK（ただし、破壊的変更は避ける）

---

## グローバル設定

### 触ってはいけないファイル

```
app.config.ts
tailwind.config.js
theme.config.js
global.css
```

### 理由

- **全画面に影響**
  - テーマカラーの変更は全画面のデザインに影響
  - Tailwind設定の変更は全コンポーネントに影響
- **ビルドエラーの原因**
  - 設定ファイルの構文エラーはビルドを完全に止める

### 例外

- **新しいテーマカラーの追加**: OK（`theme.config.js`に追加）
- **新しいTailwindクラスの追加**: OK（`tailwind.config.js`に追加）
- **既存カラーの変更**: 慎重に（全画面を確認）

---

## ビルド・デプロイ設定

### 触ってはいけないファイル

```
package.json
tsconfig.json
.env
.env.production
drizzle.config.ts
```

### 理由

- **ビルドが壊れる**
  - `package.json`の依存関係を間違えるとビルドできない
  - `tsconfig.json`の設定ミスで型チェックが動かない
- **本番環境が壊れる**
  - `.env.production`の変更はデプロイ時に影響
  - データベース接続情報の変更でサーバーが起動しない

### 例外

- **新しい依存関係の追加**: OK（`pnpm add`で追加）
- **環境変数の追加**: OK（ただし、`.env.example`も更新）

---

## 禁止ワード

### ユーザー向けテキストで使ってはいけない言葉

| 禁止ワード | 理由 | 代わりに使う言葉 |
|-----------|------|----------------|
| **認証** | 技術用語で分かりにくい | **ログイン** |
| **OAuth** | 技術用語で不安を与える | **Xの画面に移動** |
| **コールバック** | 技術用語で意味不明 | **戻ってくる** |
| **売れる** | 誇張表現で法務リスク | **判断材料になる** |
| **集客できる** | 成功保証で法務リスク | **応援を可視化する** |
| **完璧** | 過度な期待を与える | **改善しました** |
| **絶対** | 保証できない | **〜しやすくなります** |

### コメント内での使用

- **コメント内ではOK**: 技術用語は開発者向けなので問題なし
- **ユーザー向けテキストではNG**: ユーザーに表示される文言では使わない

---

## NG集の使い方

### PRレビュー時のチェック

1. **変更ファイルを確認**
   ```bash
   git diff --name-only
   ```

2. **NG集と照合**
   - 触ってはいけないファイルが含まれていないか
   - 禁止ワードが含まれていないか

3. **例外に該当するか確認**
   - 新規追加なら OK
   - 既存の変更なら慎重に

### ChatGPTに相談する際の添付

PRを作成する前に、以下をChatGPTに添付して相談：

1. 実装ガイド
2. **このNG集**
3. 変更差分（`git diff`）

ChatGPTが「NG集に抵触していないか」を確認してくれます。

---

## 更新履歴

- 2026-01-26: 初版作成（Phase 2実装ガイドから抽出）
