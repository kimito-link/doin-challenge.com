# 根本的解決の原則（絶対厳守）

**このファイルは、すべての開発・修正作業において必ず参照すること。**

---

## 基本方針

### ❌ 禁止事項：表面的な解決

以下のような表面的な修正は**絶対に禁止**します：

1. **症状の対処のみ**
   - 問題の表面だけを修正する
   - 根本原因を調査せずに修正する
   - 「とりあえず動けばいい」という考え

2. **部分的な修正**
   - 1箇所だけを修正して他を放置する
   - 整合性を確認せずに修正する
   - 全体像を把握せずに修正する

3. **一時しのぎの修正**
   - コメントで「TODO: 後で修正」と残す
   - 「今はこれで動く」という妥協
   - 技術的負債を先送りする

### ✅ 必須事項：根本的な解決

すべての修正・改善は以下の原則に従うこと：

1. **根本原因の特定**
   - なぜこの問題が発生したのかを徹底的に調査
   - 設計思想やルールの欠如を確認
   - 全体の整合性を確認

2. **ルールの明確化**
   - 問題の背景にあるルールや原則を文書化
   - ルールが存在しない場合は作成
   - ルールが曖昧な場合は明確化

3. **全体の整合性確保**
   - 修正が他の部分に影響しないか確認
   - 同様の問題が他にないか調査
   - デザインシステム全体との整合性を確認

4. **予防策の実装**
   - 同じ問題が再発しない仕組みを作る
   - ルール違反を検出する仕組みを追加
   - ドキュメント化とコードレビューでの確認

---

## 根本的解決のプロセス

### Step 1: 問題の深掘り

1. **現状の確認**
   - 問題が発生している箇所をすべて特定
   - 関連するコード・ドキュメントを確認
   - 設計思想やルールを確認

2. **根本原因の特定**
   - なぜこの問題が発生したのか
   - ルールや原則が存在するか
   - ルールが守られていない理由

3. **影響範囲の確認**
   - 同様の問題が他にないか
   - 修正が他の部分に影響しないか
   - 全体の整合性を確認

### Step 2: ルールの明確化

1. **ルールの存在確認**
   - 既存のルールや原則を確認
   - ルールが存在しない場合は作成
   - ルールが曖昧な場合は明確化

2. **ルールの文書化**
   - 明確なルールとして文書化
   - 設計原則として追加
   - コードコメントや型定義で強制

3. **ルールの適用範囲の明確化**
   - どこに適用されるか
   - 例外がある場合は理由を明確化
   - チェックリストを作成

### Step 3: 根本的な修正

1. **設計の見直し**
   - ルールに基づいた設計に変更
   - 全体の整合性を確保
   - 将来の拡張性を考慮

2. **実装**
   - ルールに従った実装
   - 型安全性やバリデーションで強制
   - テストで検証

3. **予防策の実装**
   - ルール違反を検出する仕組み
   - コードレビューでの確認項目
   - ドキュメント化

### Step 4: 検証と文書化

1. **動作確認**
   - 修正が正しく動作するか確認
   - 他の部分に影響がないか確認
   - 全体の整合性を確認

2. **ドキュメント更新**
   - ルールを設計原則に追加
   - 修正内容を記録
   - 今後の参考になるように文書化

3. **レビュー**
   - 根本的解決になっているか確認
   - 表面的な修正になっていないか確認
   - ルールが明確化されているか確認

---

## 具体例：りんくが主役のルール

### ❌ 表面的な解決（禁止）

```typescript
// 悪い例：A/Bテストでりんくを優先的に選択するだけ
function selectMessage(): LoginMessage {
  const rinkuMessages = LOGIN_MESSAGES.filter(msg => msg.character === "rinku");
  return rinkuMessages[Math.floor(Math.random() * rinkuMessages.length)];
}
```

**問題点：**
- ルールが明確化されていない
- 他の箇所で同様の問題が残る可能性
- A/Bテストの目的が不明確

### ✅ 根本的な解決（必須）

1. **ルールの明確化**
   ```markdown
   ## キャラクター表示ルール
   
   - りんくは動員ちゃれんじの主人公（メインキャラクター）
   - ログイン画面、ホーム画面、主要なUIでは必ずりんくを表示
   - 他のキャラクター（こん太、たぬ姉）は補助的な役割
   ```

2. **型定義での強制**
   ```typescript
   // キャラクターの優先順位を型で定義
   type CharacterPriority = "rinku" | "konta" | "tanune";
   
   // りんくを優先的に選択する関数
   function selectMainCharacter(): CharacterPriority {
     return "rinku"; // 常にりんく
   }
   ```

3. **全体の整合性確保**
   - すべての画面でりんくが主役として表示されているか確認
   - 例外がある場合は理由を明確化
   - デザインシステム全体で統一

4. **予防策の実装**
   - コードレビューで確認
   - 型定義で強制
   - テストで検証

---

## チェックリスト

修正作業を行う前に、以下を確認すること：

- [ ] 問題の根本原因を特定したか
- [ ] ルールや原則を確認したか
- [ ] ルールが存在しない場合は作成したか
- [ ] 全体の整合性を確認したか
- [ ] 同様の問題が他にないか確認したか
- [ ] 予防策を実装したか
- [ ] ドキュメントを更新したか
- [ ] 表面的な修正になっていないか確認したか

---

## 違反時の対応

表面的な解決を発見した場合：

1. **即座に停止**
   - 修正を中断
   - 根本原因の調査を開始

2. **根本的解決の実施**
   - 上記のプロセスに従って根本的解決を実施
   - ルールの明確化と文書化

3. **再発防止**
   - コードレビューでの確認項目に追加
   - ドキュメントを更新
   - チーム全体に共有

---

## 関連ドキュメント

- [DESIGN_PRINCIPLES.md](../DESIGN_PRINCIPLES.md) - 設計原則
- [docs/AI_INSTRUCTIONS.md](./AI_INSTRUCTIONS.md) - AI開発ガイドライン
- [docs/COMMON_MISTAKES.md](./COMMON_MISTAKES.md) - よくある間違い

---

**この原則は、すべての開発・修正作業において絶対に守ること。表面的な解決は技術的負債を増やすだけで、長期的には問題を悪化させる。**
