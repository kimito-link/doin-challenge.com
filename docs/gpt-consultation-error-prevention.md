# GPT相談：エラー防止とミス発見の構造化

## 背景

生誕祭応援アプリ「君斗りんくの動員ちゃれんじ」の開発において、以下の問題が発生しました：

1. **diffチェック機能が初めに命令されていたのに実装されなかった**
2. **その結果、Googleログイン機能が壊れた**（コミット56aa4bdでOAuth設定を変更した際、本番環境での動作確認が不十分だった）

## 問題の詳細

### 1. diffチェック機能が実装されなかった理由

- ユーザーは初めに「1つ直したら他が壊れるのを防止するdiff機能」を命令していた
- しかし、AIエージェント（Manus）はこの命令を見落とし、diffチェック機能を実装しなかった
- その結果、OAuth設定の変更がGoogleログインに影響することに気づけなかった

### 2. Googleログイン機能が壊れた経緯

- コミット56aa4bdで`server/_core/oauth.ts`を変更
- 変更内容：リダイレクトURLを動的に生成するように修正
- 問題：本番環境（doin-challenge.com）では`host.replace(/^3000-/, "8081-")`が何も置き換えず、間違ったURLにリダイレクトされた
- 原因：diffチェック機能がなく、変更の影響範囲を確認できなかった

## GPTへの質問

以下の5つの質問について、具体的なアドバイスをお願いします：

### 質問1: 命令の見落としを防ぐ方法

**質問**: AIエージェント（Manus）が初めに命令された内容（diffチェック機能）を見落とさないようにするには、どのような方法が有効ですか？

**背景**: ユーザーは「1つ直したら他が壊れるのを防止するdiff機能」を初めに命令していましたが、AIエージェントはこれを実装しませんでした。

### 質問2: デプロイ前のチェックを徹底する方法

**質問**: デプロイ前に「元々動いていた機能が壊れていないか」を自動的にチェックする仕組みを構築するには、どのような方法が有効ですか？

**背景**: Googleログイン機能が壊れたまま本番環境にデプロイされ、ユーザーが気づくまで問題が放置されました。

### 質問3: 変更の影響範囲を明確にする方法

**質問**: コードの変更が他の機能に与える影響を事前に把握するには、どのような方法が有効ですか？

**背景**: OAuth設定の変更がGoogleログインに影響することを事前に把握できませんでした。

### 質問4: エラー発生時の迅速な検出と修正

**質問**: 本番環境でエラーが発生した際、迅速に検出して修正するには、どのような方法が有効ですか？

**背景**: Googleログイン機能が壊れていることに、ユーザーが報告するまで気づけませんでした。

### 質問5: AIエージェント（Manus）との協働の最適化

**質問**: AIエージェント（Manus）と協働して開発を進める際、命令の見落としやミスを防ぐには、どのようなコミュニケーション方法が有効ですか？

**背景**: ユーザーは「1つ直したら他が壊れるのを防止するdiff機能」を初めに命令していましたが、AIエージェントはこれを実装しませんでした。

## 提案する解決策（仮案）

以下は、私たちが考えた解決策の仮案です。GPTからのアドバイスを参考に、より良い方法を検討したいと考えています。

### 1. タスク管理の構造化

- **優先度を明記**: 各タスクに優先度（高・中・低）を設定
- **期限を設定**: 各タスクに期限を設定し、遅延を防ぐ
- **依存関係を明記**: タスク間の依存関係を明記し、実装順序を明確にする

### 2. デプロイ前チェックリスト

- **diffチェック**: 変更されたファイルを自動検出し、関連するテストを実行
- **Visual Regression Testing**: スクリーンショット比較で意図しない視覚的変更を検出
- **E2Eテスト**: 主要な機能（ログイン、データ作成、表示など）を網羅的にテスト

### 3. GitHub Actionsワークフローの改善

- **デプロイ前の自動テスト**: diffチェック、Visual Regression Testing、E2Eテストを自動実行
- **デプロイ後のヘルスチェック**: 本番環境でAPIの動作確認を自動実行
- **エラー通知**: テストが失敗した場合、Slackなどで即座に通知

### 4. エラー監視ツールの導入

- **Sentry**: フロントエンドとバックエンドのエラーをリアルタイムで検知
- **UptimeRobot**: 本番環境の死活監視とヘルスチェック

## 期待する回答

以下の形式で回答をお願いします：

1. **各質問への具体的なアドバイス**（ツール、手法、ベストプラクティスなど）
2. **提案する解決策（仮案）への評価とフィードバック**
3. **追加で検討すべき事項**（見落としている問題や、より良いアプローチなど）

## 補足情報

- **開発環境**: React Native (Expo), TypeScript, tRPC, Drizzle ORM
- **デプロイ環境**: Vercel (フロントエンド), Railway (バックエンド)
- **CI/CD**: GitHub Actions
- **エラー監視**: Sentry（導入済み）
- **E2Eテスト**: Playwright（導入済み）

---

このドキュメントをGPT（ChatGPTやClaude）に送信して、具体的なアドバイスを得てください。
