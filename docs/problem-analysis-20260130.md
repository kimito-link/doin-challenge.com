# 問題分析: 作業の重複と崩壊を防ぐための改善策 (2026-01-30)

## 現在の問題点

ユーザーから以下の問題が報告されました：

1. **何回もやった作業をやらせる**: 同じ作業を繰り返し依頼される
2. **どこかなおしたらどこか崩れる**: 一箇所を修正すると、別の箇所が壊れる
3. **おかしな部分はずっとなおらない**: 根本的な問題が解決されない

---

## 根本原因の分析

### 1. 作業履歴の管理不足

**問題**: AIが過去の作業履歴を正確に把握できていない

**原因**:
- todo.mdに記録されているが、AIが毎回読み直していない
- 作業の完了状態（[x]）が正しく更新されていない
- 作業の依存関係が明確でない

**影響**:
- 同じ作業を繰り返し依頼される
- 既に完了した作業を再度実行しようとする

### 2. 状態の一元管理不足

**問題**: プロジェクトの現在の状態が複数の場所に分散している

**現状**:
- 環境変数の設定状況: Vercel、Railway、.env
- データベースの状態: Manusの管理画面
- 外部サービスの設定: Sentry、UptimeRobot
- コードの実装状況: GitHub

**影響**:
- AIが現在の状態を正確に把握できない
- ユーザーが既に完了した作業を再度依頼される

### 3. テストの不足

**問題**: 修正後の動作確認が不十分

**原因**:
- 自動テストが不足している
- 手動テストのチェックリストが不明確
- 修正の影響範囲が不明確

**影響**:
- 一箇所を修正すると、別の箇所が壊れる
- デグレード（機能の劣化）が発生する

### 4. ドキュメントの分散

**問題**: 情報が複数のmdファイルに分散している

**現状**:
- critical-features-checklist.md
- gate1.md
- visibility-issues.md
- sentry-setup.md
- setup-instructions-20260130.md
- md-full-audit-20260130-v2.md
- investigation-summary-20260130.md
- etc...

**影響**:
- AIが必要な情報を見つけられない
- ユーザーがどのドキュメントを参照すべきか分からない

---

## 改善策の提案

### 1. 作業履歴の一元管理

**解決策**: `docs/status.md`を作成し、プロジェクトの現在の状態を一元管理する

**内容**:
- 環境変数の設定状況（Sentry、UptimeRobot、etc.）
- データベースの状態（hostProfileImageの有無、etc.）
- 外部サービスの設定状況（Sentry、UptimeRobot、etc.）
- 未解決の問題（サムネイル画像の表示、etc.）

**効果**:
- AIが現在の状態を正確に把握できる
- ユーザーが既に完了した作業を再度依頼する必要がない

### 2. チェックリストの統合

**解決策**: `docs/checklist.md`を作成し、すべてのチェック項目を統合する

**内容**:
- critical-features-checklist.mdの要件
- gate1.mdのチェック項目
- visibility-issues.mdのチェック項目
- その他のチェック項目

**効果**:
- AIが必要なチェック項目を一箇所で確認できる
- ユーザーがプロジェクトの完成度を一目で確認できる

### 3. テストスクリプトの作成

**解決策**: `scripts/test-all.sh`を作成し、すべてのテストを自動実行する

**内容**:
- ログイン/ログアウトのテスト
- お気に入り機能のテスト
- フィルター機能のテスト
- 検索機能のテスト
- マイページのテスト
- `/api/health`のテスト

**効果**:
- 修正後の動作確認が自動化される
- デグレードを早期に検知できる

### 4. ドキュメントの整理

**解決策**: `docs/README.md`を作成し、すべてのドキュメントの目次を作成する

**内容**:
- 各ドキュメントの概要
- 各ドキュメントの参照タイミング
- 各ドキュメントの依存関係

**効果**:
- AIが必要な情報を素早く見つけられる
- ユーザーがどのドキュメントを参照すべきか分かる

---

## 実装計画

### Phase 1: 状態管理の一元化

1. `docs/status.md`を作成
2. 現在の状態を記録
3. AIが毎回`docs/status.md`を読むように指示

### Phase 2: チェックリストの統合

1. `docs/checklist.md`を作成
2. すべてのチェック項目を統合
3. 各項目の完了状態を記録

### Phase 3: テストの自動化

1. `scripts/test-all.sh`を作成
2. 主要な機能のテストを実装
3. GitHub Actionsで自動実行

### Phase 4: ドキュメントの整理

1. `docs/README.md`を作成
2. すべてのドキュメントの目次を作成
3. 不要なドキュメントを削除

---

## 期待される効果

1. **作業の重複を防ぐ**: AIが過去の作業履歴を正確に把握できる
2. **崩壊を防ぐ**: テストの自動化により、デグレードを早期に検知できる
3. **問題を確実に解決**: 状態管理の一元化により、根本的な問題を特定できる

---

## 次のアクション

1. ユーザーに改善策を提案
2. ユーザーの承認を得る
3. Phase 1から順次実装
