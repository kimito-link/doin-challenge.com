# X API コスト管理機能の改善 - 要件定義

## 目的
X APIの使用量監視とコスト管理機能を改善し、より効率的な運用を可能にする。

## 改善項目

### 1. キャッシュ期間の最適化
- **現状**: フォロー状態は24時間キャッシュ
- **改善**: 48時間に延長（または設定可能にする）
- **効果**: API呼び出し回数を約50%削減

### 2. エンドポイント別コスト表示
- **現状**: エンドポイント別の使用量は表示されているが、コストは表示されていない
- **改善**: 管理画面でエンドポイント別のコストを表示
- **効果**: どのエンドポイントがコストを消費しているかを可視化

### 3. 日次レポート機能
- **現状**: コスト上限到達時のアラートのみ
- **改善**: 毎日の使用量とコストをメールで通知
- **効果**: 日々の使用状況を把握し、早期に問題を発見

## 要件

### 機能要件

#### 1. キャッシュ期間の調整
- フォロー状態のキャッシュ期間を24時間から48時間に延長
- 設定ファイルまたは環境変数で変更可能にする

#### 2. エンドポイント別コスト表示
- 管理画面（`/admin/api-usage`）にエンドポイント別のコストを表示
- 既存の`getUsageByEndpoint`関数を活用
- コストの高いエンドポイントを強調表示

#### 3. 日次レポート
- 毎日午前9時（JST）に前日の使用量とコストを集計
- メール通知を送信（既存の`notifyOwner`とWebhookを使用）
- レポート内容:
  - 前日のAPI呼び出し回数
  - 前日のコスト
  - 今月の累計使用量とコスト
  - エンドポイント別の使用量トップ5

### 非機能要件
- 既存の機能に影響を与えない
- パフォーマンスへの影響を最小限に
- エラーハンドリングを適切に実装

## 成功基準
1. フォロー状態のキャッシュ期間が48時間に延長される
2. 管理画面でエンドポイント別のコストが表示される
3. 日次レポートが毎日送信される
