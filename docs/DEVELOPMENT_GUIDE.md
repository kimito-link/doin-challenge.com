# 開発ガイド

> **対象**: 人間（開発者）& AI（Manus/Claude Code）
> **最終更新**: 2026-01-22

---

## プロジェクト概要

**君斗りんくの動員ちゃれんじ** - 生誕祭応援アプリ

ファンが推しの生誕祭やイベントを応援するためのモバイルアプリ。

---

## 技術スタック

### フロントエンド
- **フレームワーク**: React Native + Expo SDK 54
- **言語**: TypeScript 5.9
- **スタイリング**: NativeWind (Tailwind CSS)
- **ルーティング**: Expo Router 6
- **状態管理**: React Context + TanStack Query

### バックエンド
- **フレームワーク**: Express + tRPC
- **データベース**: PostgreSQL (Drizzle ORM)
- **認証**: Twitter OAuth

### インフラ
- **フロントエンド**: Vercel
- **バックエンド**: Railway
- **DNS**: Cloudflare
- **リポジトリ**: GitHub

---

## 開発環境

### 必要なツール

| ツール | 用途 | 備考 |
|--------|------|------|
| Manus | AI開発アシスタント | メインの開発ツール |
| Git Bash (PC) | Gitコマンド | ワークフロー修正時 |
| GitHub Mobile (スマホ) | リポジトリ管理 | Actions確認など |
| Expo Go (スマホ) | アプリプレビュー | 実機テスト |

### 開発フロー

```
┌─────────────────────────────────────────────────────────────┐
│  Manusで開発                                                │
│  - 機能追加、バグ修正、リファクタリング                       │
│  - AIに依頼: 「〇〇を修正して」「〇〇機能を追加して」          │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  Manusがチェックポイント保存                                 │
│  - webdev_save_checkpoint で状態を保存                      │
│  - バージョン番号を付与（例: v6.53）                         │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  GitHubにpush                                               │
│  - Manusに「GitHubにpushして」と依頼                         │
│  - production/main にpushでデプロイトリガー                  │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  GitHub Actions → 自動デプロイ                              │
│  - CI → Backend → Migrate → Health Check → Frontend → E2E  │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  スマホで動作確認                                            │
│  - doin-challenge.com にアクセス                            │
│  - バグがあれば報告 → Manusで修正                            │
└─────────────────────────────────────────────────────────────┘
```

---

## ディレクトリ構成

```
birthday-celebration/
├── app/                    # Expo Router ページ
│   ├── (tabs)/            # タブナビゲーション
│   │   ├── index.tsx      # ホーム画面
│   │   ├── create.tsx     # チャレンジ作成
│   │   └── mypage.tsx     # マイページ
│   ├── event/[id].tsx     # イベント詳細
│   ├── invite/[id].tsx    # 友達招待
│   └── ...
├── components/             # 共通コンポーネント
│   ├── atoms/             # 基本UI部品
│   ├── molecules/         # 複合コンポーネント
│   └── organisms/         # 大きな機能単位
├── features/              # 機能別モジュール
│   ├── home/              # ホーム画面機能
│   ├── create/            # チャレンジ作成機能
│   ├── mypage/            # マイページ機能
│   ├── events/            # イベント関連
│   └── event-detail/      # イベント詳細
├── hooks/                 # カスタムフック
├── lib/                   # ユーティリティ
├── server/                # バックエンドコード
│   ├── routers/           # tRPCルーター
│   └── db/                # データベース関連
├── drizzle/               # DBスキーマ・マイグレーション
├── docs/                  # ドキュメント
└── todo.md                # タスク管理
```

---

## 重要なファイル

| ファイル | 説明 |
|---------|------|
| `todo.md` | タスク・バグ管理（常に最新に保つ） |
| `docs/DEPLOY_WORKFLOW.md` | デプロイ手順 |
| `docs/DEVELOPMENT_GUIDE.md` | 開発ガイド（このファイル） |
| `app.config.ts` | アプリ設定 |
| `theme.config.js` | テーマ・カラー設定 |

---

## AI（Manus/Claude Code）への指示のコツ

### 効果的な依頼の仕方

```
✅ 良い例:
「マイページのフォロー済みボタンを押すと再認証画面が出る。
 フォロー状態確認のみにして、再認証は不要にして」

❌ 悪い例:
「ボタンがおかしい」
```

### バグ報告のテンプレート

```
【画面】マイページ
【操作】「フォロー済み」ボタンを押す
【期待する動作】フォロー状態が再確認される
【実際の動作】Twitter再認証画面が表示される
【スクリーンショット】（あれば添付）
```

### 複数のバグがある場合

```
まとめて報告してから「全部修正して」と依頼するのが効率的

例:
1. マイページ：フォロー済みボタンで再認証画面
2. ホーム：フィルターでデモ画面に遷移
3. チャレンジ作成：バリデーションエラーが出ない

「この3つを全部修正して」
```

---

## バージョン管理

### バージョン番号の付け方

- **メジャー**: 大きな機能追加・破壊的変更
- **マイナー**: 機能追加・改善
- **パッチ**: バグ修正

例: `v6.53` = メジャー6、マイナー53

### todo.mdの使い方

```markdown
## v6.53 バグ修正

- [x] 完了したタスク
- [ ] 未完了のタスク
```

- 新しいバグ/機能は `[ ]` で追加
- 完了したら `[x]` に変更
- 削除しない（履歴として残す）

---

## トラブルシューティング

### よくある問題

| 問題 | 解決方法 |
|------|---------|
| pushが拒否される | `git pull production main --no-rebase` してから再push |
| TypeScriptエラー | `pnpm check` でエラー確認、修正 |
| デプロイが反映されない | GitHub Actionsのログを確認 |
| スマホで動作しない | Expo Goでプレビュー確認、ログ確認 |

### AIに聞くべきこと

- 「このエラーの原因は？」
- 「この機能を追加するにはどうすれば？」
- 「このコードをリファクタリングして」

### 人間が判断すべきこと

- 仕様の決定（どうあるべきか）
- 優先順位の決定
- デザインの方向性
