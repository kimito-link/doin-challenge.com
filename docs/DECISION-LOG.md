# 設計判断記録（Decision Log）

**最終更新**: 2026年1月15日  
**バージョン**: 4.53  
**作成者**: Manus AI

---

## 概要

本ドキュメントは「君斗りんく動員ちゃれんじ」アプリの開発過程で行われた主要な設計判断を記録したものである。各判断の背景、検討した選択肢、採用理由を明記することで、将来の改修時に「なぜこうなっているのか」を理解できるようにする。

---

## 判断記録一覧

### DEC-001: フレームワーク選定

| 項目 | 内容 |
|------|------|
| **日付** | 2026年1月 |
| **判断者** | Manus AI |
| **状態** | 採用済み |

**背景**: iOS、Android、Webの3プラットフォームに対応するモバイルアプリを開発する必要があった。

**検討した選択肢**:

| 選択肢 | メリット | デメリット |
|--------|---------|-----------|
| React Native + Expo | 1コードベースで3プラットフォーム対応、開発速度が速い | ネイティブ機能の制限あり |
| Flutter | 高パフォーマンス、美しいUI | Dartの学習コスト |
| ネイティブ開発（Swift/Kotlin） | 最高のパフォーマンス | 開発コスト3倍 |

**採用理由**: React Native + Expoを採用した。理由は以下の通りである。

1. 1つのコードベースで3プラットフォームに対応でき、開発・保守コストを削減できる
2. Expo SDK 54の成熟により、ほとんどのネイティブ機能がサポートされている
3. TypeScriptとの親和性が高く、型安全な開発が可能

---

### DEC-002: 認証方式の選定

| 項目 | 内容 |
|------|------|
| **日付** | 2026年1月 |
| **判断者** | Manus AI |
| **状態** | 採用済み |

**背景**: ユーザー認証が必要であり、ターゲットユーザーがVTuberファンであることからTwitter連携が適切と判断された。

**検討した選択肢**:

| 選択肢 | メリット | デメリット |
|--------|---------|-----------|
| Twitter OAuth 2.0 with PKCE | セキュア、フォロー確認可能 | Twitter API制限あり |
| メールアドレス認証 | シンプル | ユーザー離脱率が高い |
| Google/Apple Sign-In | 普及率が高い | フォロー確認不可 |

**採用理由**: Twitter OAuth 2.0 with PKCEを採用した。理由は以下の通りである。

1. VTuberファンはTwitterを日常的に利用しており、ログインの心理的障壁が低い
2. フォロワー限定イベントの実現にはフォロー状態の確認が必須
3. PKCEによりモバイルアプリでも安全な認証フローを実現できる

---

### DEC-003: データベース選定

| 項目 | 内容 |
|------|------|
| **日付** | 2026年1月 |
| **判断者** | Manus AI |
| **状態** | 採用済み |

**背景**: ユーザーデータ、イベントデータ、参加データを永続化する必要があった。

**検討した選択肢**:

| 選択肢 | メリット | デメリット |
|--------|---------|-----------|
| PostgreSQL + Drizzle ORM | 型安全、リレーション対応 | 学習コスト |
| Firebase Firestore | リアルタイム同期、サーバーレス | 複雑なクエリが困難 |
| SQLite（ローカル） | オフライン対応 | クロスデバイス同期不可 |

**採用理由**: PostgreSQL + Drizzle ORMを採用した。理由は以下の通りである。

1. 参加者数の集計、ランキング計算など複雑なクエリが必要
2. Drizzle ORMはTypeScriptとの親和性が高く、型安全なデータアクセスが可能
3. 将来的なスケーリングにも対応可能

---

### DEC-004: 日本地図の表現方法

| 項目 | 内容 |
|------|------|
| **日付** | 2026年1月 |
| **判断者** | Manus AI |
| **状態** | 採用済み |

**背景**: 参加者の都道府県分布を視覚的に表示する必要があった。

**検討した選択肢**:

| 選択肢 | メリット | デメリット |
|--------|---------|-----------|
| デフォルメ日本地図（グリッド） | タップしやすい、均等なサイズ | 地理的正確性が低い |
| 実際の日本地図（SVG） | 地理的に正確 | 小さい県がタップしにくい |
| リスト表示 | シンプル | 視覚的インパクトが弱い |

**採用理由**: デフォルメ日本地図（グリッド形式）を採用した。理由は以下の通りである。

1. モバイルでのタップ操作を考慮し、各都道府県を44px以上のタップエリアで表示
2. 視覚的なインパクトがあり、参加状況を一目で把握できる
3. レスポンシブ対応が容易

---

### DEC-005: オフライン対応の範囲

| 項目 | 内容 |
|------|------|
| **日付** | 2026年1月 |
| **判断者** | Manus AI |
| **状態** | 採用済み |

**背景**: モバイルアプリとして、ネットワーク接続が不安定な状況でも利用できることが望ましい。

**検討した選択肢**:

| 選択肢 | メリット | デメリット |
|--------|---------|-----------|
| 完全オフライン対応 | 常に利用可能 | 実装コスト高、同期複雑 |
| 読み取りのみオフライン | バランスが良い | 書き込みは要オンライン |
| オフライン非対応 | シンプル | UX低下 |

**採用理由**: 読み取りのみオフライン対応を採用した。理由は以下の通りである。

1. チャレンジ一覧、参加状況の閲覧はオフラインでも可能
2. 参加表明などの書き込み操作はオンライン復帰後に同期
3. 実装コストと利便性のバランスが最適

---

### DEC-006: トークン管理方式

| 項目 | 内容 |
|------|------|
| **日付** | 2026年1月 |
| **判断者** | Manus AI |
| **状態** | 採用済み |

**背景**: Twitter APIのアクセストークンを安全に管理する必要があった。

**検討した選択肢**:

| 選択肢 | メリット | デメリット |
|--------|---------|-----------|
| サーバーサイド保存 | セキュア | API呼び出しがサーバー経由 |
| クライアントサイド保存（SecureStore） | 直接API呼び出し可能 | 漏洩リスク |
| ハイブリッド（リフレッシュトークンのみサーバー） | バランス | 実装複雑 |

**採用理由**: サーバーサイド保存を採用した。理由は以下の通りである。

1. アクセストークンがクライアントに露出しないため、セキュリティが高い
2. レート制限の管理をサーバー側で一元化できる
3. トークン更新ロジックをサーバー側に集約できる

---

### DEC-007: プッシュ通知の実装方式

| 項目 | 内容 |
|------|------|
| **日付** | 2026年1月 |
| **判断者** | Manus AI |
| **状態** | 採用済み |

**背景**: マイルストーン達成時にユーザーへ通知を送信する必要があった。

**検討した選択肢**:

| 選択肢 | メリット | デメリット |
|--------|---------|-----------|
| Expo Push Notifications | Expo統合、簡単 | Expoサーバー依存 |
| Firebase Cloud Messaging | 高機能、無料 | 設定が複雑 |
| OneSignal | 管理画面充実 | 有料プラン必要 |

**採用理由**: Expo Push Notificationsを採用した。理由は以下の通りである。

1. Expoプロジェクトとの統合が容易
2. iOS/Android両方に対応
3. 無料で利用可能

---

### DEC-008: テーマ切り替え方式

| 項目 | 内容 |
|------|------|
| **日付** | 2026年1月 |
| **判断者** | Manus AI |
| **状態** | 採用済み |

**背景**: ダークモード対応が求められた。

**検討した選択肢**:

| 選択肢 | メリット | デメリット |
|--------|---------|-----------|
| システム設定に追従 | ユーザー操作不要 | 手動切り替え不可 |
| 手動切り替えのみ | ユーザー制御可能 | 初期設定が必要 |
| ハイブリッド（システム/手動選択可） | 柔軟性が高い | 実装やや複雑 |

**採用理由**: ハイブリッド方式を採用した。理由は以下の通りである。

1. デフォルトはシステム設定に追従し、ユーザー操作不要
2. 必要に応じて手動でライト/ダークを固定可能
3. 設定はAsyncStorageに永続化

---

## 今後の検討事項

以下の項目は将来的に再検討が必要である。

| 項目 | 現状 | 検討理由 |
|------|------|---------|
| リアルタイム更新 | ポーリング（30秒） | WebSocket対応サーバーへの移行時 |
| 画像最適化 | expo-image | CDN導入時にWebP/AVIF対応検討 |
| 国際化 | 日本語のみ | 海外展開時 |

---

## 評価ポイント

設計判断を評価する際のチェックポイント：

- [ ] 各判断の背景と理由が明確か
- [ ] 検討した選択肢が網羅的か
- [ ] 採用理由が論理的か
- [ ] 将来の変更可能性が考慮されているか
- [ ] セキュリティ面の考慮があるか
