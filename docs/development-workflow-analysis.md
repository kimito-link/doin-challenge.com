# 「Gitで開発する基本作法」と現在のプロジェクトの問題点の比較分析

**作成日時**: 2026-01-30

---

## 提示された開発作法の核心原則

### 1. **要件定義の明確化**（REQUIREMENTS.md）

```
6-1: 要件定義をしたいです。docsフォルダ内にREQUIREMENTS.mdで保存します。
     まだ作業はしないでください。これから作りたいモノを言うので、
     不明瞭なところがあれば質問してください。
```

**目的**: 何を作るのかを明確にする

**効果**: 
- 実装前に要件を確定
- 不明瞭な点を事前に解消
- 実装中の迷いを減らす

### 2. **TDD駆動開発**（設計書・タスク・テストケース）

```
6-4: REQUIREMENTS.mdを元に、TDD駆動開発用の、設計書・タスク・テストケースを作って
     docsフォルダに保存してください。
```

**目的**: テストファーストで開発する

**効果**:
- テストケースを先に作る → 期待される動作が明確
- 実装後、テストで確認 → 壊れたらすぐに検知
- リグレッション防止 → 既存機能が壊れたら、テストが失敗

### 3. **段階的コミット**（1つの作業ごとにcommit）

```
6-6: TODOに従ってTDD実装してください。テストに通らない場合は次に進まずに、
     確実な動作を確認してから次に進んでください。
     1つの作業を終えるたびに、作業内容の要約をコメントとしてcommitしてください。
```

**目的**: 小さな単位でコミットし、問題が発生したらすぐに戻れるようにする

**効果**:
- 問題が発生したら、直前のコミットに戻れる
- 影響範囲が小さい → 問題の原因を特定しやすい
- コミット履歴が詳細 → 何が変わったのかが明確

### 4. **作業履歴の記録**（PROGRESS.md）

```
6-5: 作業履歴（PROGRESS.md）を記録したら、git commitしてください。
6-6: その際は作業履歴をPROGRESS.mdにつけて、次に作業を再開するときに
     スムーズにできるように準備しておいてください。
```

**目的**: 何をしたのか、次に何をするのかを記録する

**効果**:
- 作業の継続性 → 次回、どこから始めるかが明確
- 問題の追跡 → 何が原因で壊れたのかを特定しやすい
- コミュニケーション → 他の開発者（またはAI）が状況を理解しやすい

---

## 現在のプロジェクトとの比較

### ❌ 欠けている要素

| 提示された作法 | 現在のプロジェクト | 結果 |
|--------------|------------------|------|
| **REQUIREMENTS.md** | ❌ 存在しない | 要件が不明確、実装中に迷う |
| **TDD駆動開発** | ❌ テストがない | 壊れても気づかない |
| **段階的コミット** | ❌ 一気に実装してからコミット | 問題が発生したら、どこが原因かわからない |
| **PROGRESS.md** | ❌ 存在しない（todo.mdはあるが不完全） | 次に何をするかが不明確 |
| **テストに通らない場合は次に進まない** | ❌ テストせずに次に進む | 壊れたまま実装を続ける |

### ✅ 部分的に実装されている要素

| 提示された作法 | 現在のプロジェクト | 問題点 |
|--------------|------------------|--------|
| **git commit** | ✅ チェックポイント作成 | コミット単位が大きすぎる（1機能全体） |
| **作業履歴** | ✅ todo.md | 更新されていない、形骸化している |
| **設計書** | ✅ docs/*.md | 実装と乖離している |

---

## 「この概念が含まれていれば、基本的にこんな事は起きない」理由

### 理由1: **TDD駆動開発 → 壊れたらすぐに検知**

**提示された作法**:
1. テストケースを先に作る
2. 実装する
3. テストを実行
4. テストに通らない場合は次に進まない

**効果**:
- サムネイル画像が消えた → テストが失敗 → すぐに気づく
- Twitterログインが壊れた → テストが失敗 → すぐに気づく
- 性別統計が表示されない → テストが失敗 → すぐに気づく

**現在のプロジェクト**:
- テストがない → 壊れても気づかない
- チェックポイント作成後、ユーザーが確認して初めて気づく

### 理由2: **段階的コミット → 問題の原因を特定しやすい**

**提示された作法**:
1. データベース層を実装 → テスト → commit
2. API層を実装 → テスト → commit
3. UI層を実装 → テスト → commit

**効果**:
- 問題が発生したら、直前のコミットに戻れる
- 影響範囲が小さい → 原因を特定しやすい

**現在のプロジェクト**:
- 一気に実装してからコミット → 問題が発生したら、どこが原因かわからない
- v6.172で3つの問題が同時に発生 → 原因を特定できない

### 理由3: **要件定義の明確化 → 実装中の迷いを減らす**

**提示された作法**:
1. REQUIREMENTS.mdで要件を明確化
2. 不明瞭な点を事前に解消
3. 実装中に迷わない

**効果**:
- 「性別統計をどこに表示するか」が明確
- 「APIはどのようなデータを返すか」が明確
- 実装中に迷わない → 不完全な実装を避ける

**現在のプロジェクト**:
- 要件が不明確 → 実装中に迷う
- API関数を作成したと思っていたが、実際には存在しなかった

### 理由4: **PROGRESS.md → 次に何をするかが明確**

**提示された作法**:
1. 作業履歴をPROGRESS.mdに記録
2. 次に作業を再開するときにスムーズにできる

**効果**:
- 「次はAPI層を実装する」が明確
- 「データベース層は完了した」が記録されている
- 作業の継続性が保たれる

**現在のプロジェクト**:
- todo.mdはあるが、更新されていない
- 次に何をするかが不明確 → 一気に実装してしまう

---

## 具体例: v6.172の失敗を提示された作法で防ぐ

### 提示された作法で実装した場合

#### ステップ1: 要件定義（REQUIREMENTS.md）

```markdown
# 性別統計表示機能

## 要件
- ホーム画面のチャレンジカードに、参加者の性別統計を表示する
- 表示形式: ♂ 3 ♀ 2 ? 1
- 配色: 男性=青、女性=ピンク、未設定=ニュートラル

## 不明瞭な点
- Q: 性別統計はどこに表示するか？
- A: 進捗情報の下に表示

- Q: APIはどのようなデータを返すか？
- A: `genderStats: { maleCount: number, femaleCount: number, unspecifiedCount: number }`
```

#### ステップ2: 設計書・タスク・テストケース

```markdown
# 設計書

## データベース層
- `participations`テーブルの`gender`カラムから性別統計を集計
- SQLクエリ: `SELECT challengeId, SUM(CASE WHEN gender = 'male' THEN 1 ELSE 0 END) as maleCount, ...`

## API層
- `getAllEventsWithGenderStats()`関数を作成
- 各チャレンジに性別統計を追加

## UI層
- `GenderStats`コンポーネントを作成
- `ColorfulChallengeCard`に統合

# タスク
- [ ] データベース層: SQLクエリを実装
- [ ] API層: `getAllEventsWithGenderStats()`を実装
- [ ] UI層: `GenderStats`コンポーネントを作成
- [ ] UI層: `ColorfulChallengeCard`に統合

# テストケース
- [ ] SQLクエリが正しく性別統計を集計する
- [ ] APIが正しく性別統計を返す
- [ ] `GenderStats`コンポーネントが正しく表示される
- [ ] `ColorfulChallengeCard`にサムネイルと性別統計が両方表示される
```

#### ステップ3: TDD実装

**3-1: データベース層**

```bash
# SQLクエリを実装
# テストを実行
npm run test:db

# テストに通った
git add .
git commit -m "データベース層: 性別統計を集計するSQLクエリを実装"
```

**3-2: API層**

```bash
# getAllEventsWithGenderStats()を実装
# テストを実行
npm run test:api

# テストに通った
git add .
git commit -m "API層: getAllEventsWithGenderStats()を実装"
```

**3-3: UI層（GenderStatsコンポーネント）**

```bash
# GenderStatsコンポーネントを実装
# テストを実行
npm run test:ui

# テストに通った
git add .
git commit -m "UI層: GenderStatsコンポーネントを実装"
```

**3-4: UI層（ColorfulChallengeCardに統合）**

```bash
# ColorfulChallengeCardにGenderStatsを統合
# テストを実行
npm run test:ui

# テストに通らない！
# エラー: サムネイル画像が表示されない

# 原因を調査
# 修正
# テストを再実行
npm run test:ui

# テストに通った
git add .
git commit -m "UI層: ColorfulChallengeCardにGenderStatsを統合（サムネイル表示の問題を修正）"
```

#### ステップ4: 統合テスト

```bash
# 全体のテストを実行
npm run test

# テストに通った
# ステータスダッシュボードで確認
# 全機能が正常に動作

git add .
git commit -m "性別統計表示機能を実装完了"
```

#### ステップ5: PROGRESS.mdを更新

```markdown
# 作業履歴

## 2026-01-30: 性別統計表示機能を実装完了

### 完了したタスク
- [x] データベース層: SQLクエリを実装
- [x] API層: getAllEventsWithGenderStats()を実装
- [x] UI層: GenderStatsコンポーネントを実装
- [x] UI層: ColorfulChallengeCardに統合

### 問題と解決
- 問題: ColorfulChallengeCardにGenderStatsを統合した際、サムネイル画像が表示されなくなった
- 原因: スタイルの競合
- 解決: スタイルを修正

### 次のタスク
- マイページに性別統計を表示
```

---

## 結論

### 「この概念が含まれていれば、基本的にこんな事は起きない」理由

1. **TDD駆動開発**: 壊れたらすぐに検知 → サムネイル画像が消えたら、テストが失敗
2. **段階的コミット**: 問題の原因を特定しやすい → どのコミットで壊れたかが明確
3. **要件定義の明確化**: 実装中の迷いを減らす → 不完全な実装を避ける
4. **PROGRESS.md**: 次に何をするかが明確 → 一気に実装してしまうことを避ける
5. **テストに通らない場合は次に進まない**: 壊れたまま実装を続けない

### 現在のプロジェクトに欠けているもの

1. ❌ **テスト**: 壊れても気づかない
2. ❌ **段階的コミット**: 一気に実装してからコミット
3. ❌ **要件定義**: 実装中に迷う
4. ❌ **PROGRESS.md**: 次に何をするかが不明確
5. ❌ **テストファースト**: テストせずに次に進む

---

## 次のアクション

### 今すぐ実施すべきこと

1. **REQUIREMENTS.mdを作成**
   - 性別統計表示機能の要件を明確化
   - 不明瞭な点を解消

2. **テストケースを作成**
   - サムネイル画像が表示されるか
   - 性別統計が表示されるか
   - Twitterログインが動作するか

3. **段階的実装**
   - データベース層 → テスト → commit
   - API層 → テスト → commit
   - UI層 → テスト → commit

4. **PROGRESS.mdを作成**
   - 作業履歴を記録
   - 次に何をするかを明確化

---

**質問**: この開発作法を採用して、プロジェクトを立て直しますか？
