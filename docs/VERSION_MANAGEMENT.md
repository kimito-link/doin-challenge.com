# バージョン管理ガイド

**最終更新**: 2026-02-09  
**対象者**: 開発者全員

## 📋 バージョンアップの基準

### 基本原則

**1変更 = 1コミット = 1バージョンアップ**

コードに変更を加えたら、必ずバージョンを1つ上げます。

### バージョンを上げるタイミング

以下のいずれかに該当する場合は、**必ずバージョンを上げる**：

#### ✅ 必ずバージョンを上げる

1. **機能追加・改善**
   - 新機能を追加した
   - 既存機能を改善した
   - UI/UXの変更をした

2. **バグ修正**
   - バグを修正した
   - エラーハンドリングを改善した

3. **リファクタリング**
   - コードの構造を変更した
   - パフォーマンスを改善した
   - コードの可読性を向上させた

4. **設定・環境の変更**
   - 環境変数を追加・変更した
   - ビルド設定を変更した
   - 依存関係を更新した

5. **ドキュメントの更新**
   - 重要なドキュメントを追加・更新した
   - API仕様を変更した

#### ❌ バージョンを上げない

- タイポ修正のみ（機能に影響しない）
- コメント追加のみ
- 空白・インデントの調整のみ

### バージョン番号の形式

現在の形式: `6.XXX`（メジャー6、マイナーXXX）

- **メジャーバージョン（6）**: 大きな変更があった場合のみ変更
- **マイナーバージョン（XXX）**: 通常はこちらを1つずつ増やす

**例**:
- `6.182` → `6.183`（通常の変更）
- `6.182` → `7.0`（大きな破壊的変更がある場合のみ）

### バージョンアップの手順

1. **コードを変更**
2. **テストを実行**
3. **コミット**
   ```bash
   git commit -m "v6.183: 変更内容の要約"
   ```
4. **バージョン番号を更新**
   - `shared/version.ts`の`APP_VERSION`を更新
   ```typescript
   export const APP_VERSION = "6.183";
   ```
5. **バージョン更新をコミット**
   ```bash
   git add shared/version.ts
   git commit -m "v6.183: バージョン番号を更新"
   ```

### コミットメッセージの形式

```
v6.XXX: 変更内容の要約
```

**例**:
- `v6.183: OAuth Cookie設定の修正`
- `v6.184: データベース接続エラーの修正`
- `v6.185: Twitter OAuthコールバック後のセッション確立を修正`

### よくある質問

#### Q: 小さな変更でもバージョンを上げる必要がありますか？

**A: はい。** どんな小さな変更でも、コードに変更を加えたらバージョンを上げます。これにより：
- 問題が発生したときに原因を特定しやすい
- ロールバックが容易になる
- 変更履歴が明確になる

#### Q: 複数の変更を1つのコミットにまとめた場合、バージョンは1つだけ上げればいいですか？

**A: 原則として、1つのコミットに1つの変更のみを含めるべきです。** しかし、どうしても複数の変更をまとめる場合は、1つのバージョンアップでOKです。

#### Q: バージョンを上げるのを忘れた場合は？

**A: 次のコミットでバージョンを上げてください。** ただし、忘れないように注意してください。

### チェックリスト

コミット前に以下を確認：

- [ ] コードに変更を加えた
- [ ] `shared/version.ts`の`APP_VERSION`を更新した
- [ ] コミットメッセージに`v6.XXX:`形式でバージョン番号を含めた
- [ ] テストを実行した（可能な場合）

### 現在のバージョン

最新のバージョンは`shared/version.ts`で確認できます：

```typescript
export const APP_VERSION = "6.182";  // ← ここを確認
```

### バージョン履歴の確認

- **Git履歴**: `git log --oneline | grep "v6\."`
- **リリースノート**: データベースの`release_notes`テーブル
- **本番環境**: `https://doin-challenge.com/api/health`の`version`フィールド

---

## 📝 まとめ

**バージョンを上げる基準はシンプルです：**

> **コードに変更を加えたら、必ずバージョンを1つ上げる**

これにより、問題の特定とロールバックが容易になり、開発の品質が向上します。
