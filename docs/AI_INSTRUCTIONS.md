# AI実装ガイドライン

**このファイルは、AI（Manus、ChatGPT、Claude等）が実装を行う際に必ず参照するガイドラインです。**

---

## 【最優先】命令の忠実な実行と記憶の扱い

**以下は毎タスクで守ること。推測や記憶で上書きしない。**

### 1. 作業前に必ずやること

- **該当する docs の該当箇所をその場で読む**  
  ユーザーが「〇〇して」と言ったとき、その作業に関係する md（例: `docs/contract.md`, `docs/GIT_DEVELOPMENT_WORKFLOW.md`, `docs/GATE1_WORKFLOW.md`）があれば、**作業開始前に必ず開いて該当部分を読む**。
- **「だいたい覚えている」で進めない**  
  過去の会話や一般的な知識に頼らず、**このリポジトリの md に書いてある文言を優先する**。矛盾したら「md の記載」を正とする。
- **タスクのたびに「どの doc に従うか」を明示する**  
  実装や変更に入る前に、短くでよいので  
  「`docs/〇〇.md` の △△ に従い、〇〇します」  
  と一度書く。これで「今、どのルールに忠実に従っているか」が明確になる。

### 2. やってはいけないこと

- **md を読まずに「いつもの流れ」で進める**  
  例: 「契約の 4 点セット」「Gate 1」「Git の手順 6-6」などは、**その都度該当 md を開いて確認する**。
- **書いてないことを「おそらくこうだろう」で決める**  
  不明点は **推測で補完せず、ユーザーに確認する**。  
  例: 「〇〇.md には △△ とありますが、この場合は □□ でよいですか？」
- **長い会話の「流れ」だけで判断する**  
  会話が長くなっても、**いまのタスクの根拠は「どの md のどの記述か」を意識する**。あいまいになったら、その md を再読する。

### 3. 適用の仕方（習慣にする）

1. **指示を受けたら**  
   「この作業では `docs/〇〇.md` の 〇〇 を満たします」と書く（または心がける）。
2. **変更・実装する前に**  
   該当 md の該当ブロック（手順・Done 条件・禁止事項）を **引用または要約して 1 行書く**。  
   例: 「`GIT_DEVELOPMENT_WORKFLOW.md` の 6-6 により、1 作業ごとに commit と PROGRESS.md 更新を行います。」
3. **作業後**  
   「〇〇.md の △△ を満たした」と短く確認する。  
   これで「命令が md どおりに実行された」ことが残る。

### 4. このリポジトリで特に参照する docs

| 作業の種類 | 必ず参照する doc |
|------------|------------------|
| 新機能・仕様を決める | `docs/contract.md`（4 点セット） |
| Git の流れ・TDD・PROGRESS | `docs/GIT_DEVELOPMENT_WORKFLOW.md`（手順 1〜6, 6-1〜6-6） |
| 危険な変更・PR・デプロイ | `docs/GATE1_WORKFLOW.md`, `.github/pull_request_template.md`, `scripts/diff-check.sh` |
| 実装方針・コンポーネント | 本ファイルの「曖昧な指示への対応」以降、および `docs/COMPONENT_REGISTRY.md` 等 |

**まとめ**: md に書いてあることを「その場で読んで、書いてあるとおりに実行する」。記憶や文脈で上書きしない。不明なら確認する。

---

## 曖昧な指示への対応

**ユーザーから曖昧な指示を受けた場合、必ず以下の質問テンプレートを使用して明確化すること。**

### 1. 「UIを改善して」と言われた場合

**質問テンプレート**:
```
「UIを改善して」というご指示ですが、具体的にどの部分を改善しますか？

1. **どの画面ですか？**
   - [ ] ホーム画面
   - [ ] チャレンジ詳細画面
   - [ ] マイページ
   - [ ] その他（具体的に:          ）

2. **どの要素ですか？**
   - [ ] ボタン
   - [ ] テキスト
   - [ ] 画像
   - [ ] レイアウト
   - [ ] 色
   - [ ] その他（具体的に:          ）

3. **どのように改善しますか？**
   - [ ] サイズを変更
   - [ ] 色を変更
   - [ ] 配置を変更
   - [ ] アニメーションを追加
   - [ ] その他（具体的に:          ）

4. **参考資料はありますか？**
   - [ ] スクリーンショット
   - [ ] URL
   - [ ] その他（具体的に:          ）
```

---

### 2. 「バグを修正して」と言われた場合

**質問テンプレート**:
```
「バグを修正して」というご指示ですが、具体的にどのバグですか？

1. **どの画面で発生しますか？**
   - [ ] ホーム画面
   - [ ] チャレンジ詳細画面
   - [ ] マイページ
   - [ ] その他（具体的に:          ）

2. **どのような操作で発生しますか？**
   - [ ] ボタンを押す
   - [ ] スクロールする
   - [ ] ログインする
   - [ ] その他（具体的に:          ）

3. **どのような現象ですか？**
   - [ ] クラッシュする
   - [ ] 表示がおかしい
   - [ ] 動作しない
   - [ ] その他（具体的に:          ）

4. **エラーメッセージはありますか？**
   - [ ] はい（内容:          ）
   - [ ] いいえ

5. **再現手順を教えてください**
   1. 
   2. 
   3. 
```

---

### 3. 「機能を追加して」と言われた場合

**質問テンプレート**:
```
「機能を追加して」というご指示ですが、具体的にどの機能ですか？

1. **どの画面に追加しますか？**
   - [ ] ホーム画面
   - [ ] チャレンジ詳細画面
   - [ ] マイページ
   - [ ] 新しい画面
   - [ ] その他（具体的に:          ）

2. **どのような機能ですか？**
   - [ ] ボタン
   - [ ] フォーム
   - [ ] リスト
   - [ ] その他（具体的に:          ）

3. **どのような動作をしますか？**
   - [ ] データを取得
   - [ ] データを保存
   - [ ] データを削除
   - [ ] その他（具体的に:          ）

4. **既存の機能と統合しますか？**
   - [ ] はい（どの機能:          ）
   - [ ] いいえ

5. **参考資料はありますか？**
   - [ ] スクリーンショット
   - [ ] URL
   - [ ] その他（具体的に:          ）
```

---

### 4. 「デザインを変更して」と言われた場合

**質問テンプレート**:
```
「デザインを変更して」というご指示ですが、具体的にどの部分を変更しますか？

1. **どの画面ですか？**
   - [ ] ホーム画面
   - [ ] チャレンジ詳細画面
   - [ ] マイページ
   - [ ] その他（具体的に:          ）

2. **どの要素ですか？**
   - [ ] 色
   - [ ] フォント
   - [ ] レイアウト
   - [ ] アイコン
   - [ ] その他（具体的に:          ）

3. **どのように変更しますか？**
   - [ ] 色を変更（変更前:     → 変更後:     ）
   - [ ] フォントサイズを変更（変更前:     → 変更後:     ）
   - [ ] レイアウトを変更（具体的に:          ）
   - [ ] その他（具体的に:          ）

4. **参考資料はありますか？**
   - [ ] スクリーンショット
   - [ ] URL
   - [ ] カラーコード
   - [ ] その他（具体的に:          ）
```

---

## 実装チェックポイント

**実装を開始する前と完了後に、必ず以下のチェックポイントを確認すること。**

### チェックポイント1: 実装開始前の確認

**ユーザーに以下を確認してから実装を開始すること:**

```
実装を開始する前に、以下を確認させてください:

1. **実装内容の確認**
   - 実装する機能: [具体的な機能名]
   - 実装する画面: [画面名]
   - 実装する要素: [要素名]

2. **設計原則の確認**
   - `DESIGN_PRINCIPLES.md` を確認しました
   - 設計原則に違反していないことを確認しました

3. **既存コンポーネントの確認**
   - 既存のコンポーネントを検索しました
   - 以下のコンポーネントを再利用します:
     - [コンポーネント名1]
     - [コンポーネント名2]
   - または、新しいコンポーネントを作成します: [コンポーネント名]

4. **実装方針**
   - [実装方針を簡潔に説明]

上記の内容で実装を開始してよろしいですか？
```

---

### チェックポイント2: 実装完了後の確認

**実装完了後、ユーザーに以下を報告すること:**

```
実装が完了しました。以下を確認してください:

1. **実装内容**
   - 実装した機能: [具体的な機能名]
   - 実装した画面: [画面名]
   - 実装した要素: [要素名]

2. **変更ファイル**
   - [ファイル名1]: [変更内容]
   - [ファイル名2]: [変更内容]

3. **テスト結果**
   - [ ] TypeScriptエラーなし
   - [ ] 開発サーバー起動成功
   - [ ] 動作確認完了

4. **更新したドキュメント**
   - [ ] `COMPONENT_REGISTRY.md` を更新
   - [ ] `todo.md` を更新

5. **次のステップ**
   - [ ] チェックポイント作成
   - [ ] 本番環境でテスト

上記の内容で問題ありませんか？
```

---

## 実装前の必須チェック

### 1. 設計原則の確認

**実装を開始する前に、必ず `DESIGN_PRINCIPLES.md` を読むこと。**

```bash
# ファイルを読む
file read /home/ubuntu/birthday-celebration/DESIGN_PRINCIPLES.md
```

- **違反していないか確認**: 実装内容が設計原則に違反していないか確認
- **不明点があれば質問**: 設計原則に不明点があれば、ユーザーに質問

---

### 2. 既存コンポーネントの検索

**新しいコンポーネントを作成する前に、必ず既存のコンポーネントを検索すること。**

```bash
# components/ ディレクトリ全体を検索
match --action glob --scope "/home/ubuntu/birthday-celebration/components/**/*.tsx"

# 特定の機能を持つコンポーネントを検索（例: ログイン）
match --action grep --scope "/home/ubuntu/birthday-celebration/components/**/*.tsx" --regex "login|Login|auth|Auth"
```

---

### 3. コンポーネントレジストリの確認

**`docs/COMPONENT_REGISTRY.md` を読み、既存コンポーネントを再利用できないか確認すること。**

```bash
# ファイルを読む
file read /home/ubuntu/birthday-celebration/docs/COMPONENT_REGISTRY.md
```

- **既存コンポーネントの確認**: 同じ機能を持つコンポーネントが既に存在しないか確認
- **再利用の検討**: 既存のコンポーネントを再利用できないか検討

---

## 実装時のガイドライン

### 1. ログイン機能

**ログインUIは `components/common/LoginModal.tsx` のみ使用すること。**

#### 使用例

```tsx
import { LoginModal } from "@/components/common/LoginModal";
import { useState } from "react";

export function MyComponent() {
  const [showLoginModal, setShowLoginModal] = useState(false);

  const handleLogin = () => {
    // ログイン処理
    console.log("ログイン処理を開始");
  };

  return (
    <>
      <Button onPress={() => setShowLoginModal(true)}>
        ログイン
      </Button>
      
      <LoginModal
        visible={showLoginModal}
        onConfirm={handleLogin}
        onCancel={() => setShowLoginModal(false)}
      />
    </>
  );
}
```

#### 禁止事項

- **新しいログインUIを作成しない**: `LoginModal` 以外のログインUIを作成しない
- **青いバナーを作成しない**: シンプルなログインボタンを作成しない
- **重複実装を避ける**: ログイン機能を複数の場所で実装しない

---

### 2. コンポーネントの作成

**新しいコンポーネントを作成する場合、以下のガイドラインに従うこと。**

#### 配置場所

- **共通コンポーネント**: `components/common/` に配置
- **UI部品**: `components/ui/` に配置
- **Atoms（最小単位）**: `components/atoms/` に配置
- **Molecules（複合部品）**: `components/molecules/` に配置
- **Organisms（複雑な部品）**: `components/organisms/` に配置
- **機能別コンポーネント**: `features/` に配置

#### ファイル命名規則

- **PascalCase**: `LoginModal.tsx`、`ChallengeCard.tsx`
- **kebab-case**: `login-modal.tsx`、`challenge-card.tsx`（プロジェクトの規則に従う）

#### コンポーネントの構造

```tsx
import { View, Text } from "react-native";
import { cn } from "@/lib/utils";

export interface MyComponentProps {
  title: string;
  onPress: () => void;
  disabled?: boolean;
}

/**
 * MyComponent の説明
 * 
 * @param title - タイトル
 * @param onPress - ボタン押下時のコールバック
 * @param disabled - 無効化フラグ
 */
export function MyComponent({ title, onPress, disabled }: MyComponentProps) {
  return (
    <View className={cn("p-4", disabled && "opacity-50")}>
      <Text className="text-lg font-bold">{title}</Text>
      <Button onPress={onPress} disabled={disabled}>
        ボタン
      </Button>
    </View>
  );
}
```

---

### 3. スタイリング

**Tailwind CSS（NativeWind）を使用すること。**

#### 使用例

```tsx
<View className="flex-1 items-center justify-center p-4">
  <Text className="text-2xl font-bold text-foreground">
    Hello World
  </Text>
</View>
```

#### 禁止事項

- **グローバルスタイルに依存しない**: `styles.ts` などのグローバルスタイルに依存しない
- **インラインスタイルを避ける**: 可能な限り Tailwind CSS を使用

---

## 実装後の必須チェック

### 1. 重複チェック

**実装後、同じ機能を持つコンポーネントが複数存在しないか確認すること。**

```bash
# 類似コンポーネントを検索
match --action grep --scope "/home/ubuntu/birthday-celebration/components/**/*.tsx" --regex "MyComponent|my-component"
```

- **重複がある場合**: 統合する
- **重複がない場合**: 次のステップに進む

---

### 2. コンポーネントレジストリの更新

**新しいコンポーネントを作成した場合、`docs/COMPONENT_REGISTRY.md` に追加すること。**

#### 追加する情報

- **パス**: コンポーネントのファイルパス
- **用途**: コンポーネントの用途
- **使用箇所**: コンポーネントが使用されている場所
- **Props**: 主要な Props

#### 追加例

```markdown
### MyComponent
- **パス**: `components/common/MyComponent.tsx`
- **用途**: カスタムコンポーネント
- **使用箇所**: ホーム、チャレンジ
- **Props**:
  - `title: string` - タイトル
  - `onPress: () => void` - ボタン押下時のコールバック
  - `disabled?: boolean` - 無効化フラグ
```

---

### 3. todo.md の更新

**実装が完了したら、`todo.md` のタスクを完了としてマークすること。**

```markdown
- [x] MyComponent を作成
```

---

## チェックポイント前のチェック

**`webdev_save_checkpoint` を実行する前に、以下をチェックすること:**

### 1. 設計原則の確認

```bash
# DESIGN_PRINCIPLES.md を読む
file read /home/ubuntu/birthday-celebration/DESIGN_PRINCIPLES.md
```

- **違反していないか確認**: 実装内容が設計原則に違反していないか確認

---

### 2. コンポーネントレジストリの確認

```bash
# COMPONENT_REGISTRY.md を読む
file read /home/ubuntu/birthday-celebration/docs/COMPONENT_REGISTRY.md
```

- **最新か確認**: コンポーネントレジストリが最新か確認
- **更新**: 新しいコンポーネントを追加した場合は更新

---

### 3. 重複実装の確認

```bash
# 重複実装を検索
match --action grep --scope "/home/ubuntu/birthday-celebration/components/**/*.tsx" --regex "login|Login|auth|Auth"
```

- **重複がないか確認**: 同じ機能を持つコンポーネントが複数存在しないか確認

---

## 定期的なチェック

### 週次チェック

**週に1回、以下をチェックすること:**

1. **重複実装がないか**: `match` ツールで検索
2. **設計原則に違反していないか**: `DESIGN_PRINCIPLES.md` を再確認
3. **コンポーネントレジストリが最新か**: `docs/COMPONENT_REGISTRY.md` を更新

---

## トラブルシューティング

### 問題: 同じ機能を持つコンポーネントが複数存在する

**解決策**:
1. 既存のコンポーネントを確認
2. どちらのコンポーネントを使用するか決定
3. 使用しないコンポーネントを削除または非推奨とする
4. `docs/COMPONENT_REGISTRY.md` を更新

---

### 問題: 設計原則に違反している

**解決策**:
1. `DESIGN_PRINCIPLES.md` を読む
2. 違反している箇所を特定
3. 修正する
4. ユーザーに報告

---

### 問題: コンポーネントレジストリが古い

**解決策**:
1. 新しいコンポーネントを確認
2. `docs/COMPONENT_REGISTRY.md` に追加
3. チェックポイントを作成

---

## ユーザーへの質問

**不明点がある場合は、ユーザーに質問すること。**

### 質問例

- 「既存の `LoginModal` を使用しますか？それとも新しいログインUIを作成しますか？」
- 「このコンポーネントは共通化できますか？」
- 「この実装は設計原則に違反していますか？」

---

## 実装効率化のヒント

### 1. 複数ファイルの方が効果的

**1つの大きなファイルよりも、複数の小さなファイルに分割する方が3倍効果的です。**

- **理由**: AIは複数のファイルを読むことで、より正確に実装できる
- **推奨**: 5-10分で読める長さ（1000-2000語）のファイルに分割

**例**:
- ❌ 悪い例: 1つの大きな `AI_INSTRUCTIONS.md`（10,000語）
- ✅ 良い例: `AI_INSTRUCTIONS.md`（2,000語）+ `COMMON_MISTAKES.md`（2,000語）+ `COMPONENT_REGISTRY.md`（1,500語）

---

### 2. 明示的な指示が重要

**AIに実装を依頼する際は、明示的に「〇〇を読んでください」と指示すること。**

**例**:
```
「ログイン機能を実装してください。DESIGN_PRINCIPLES.md と COMPONENT_REGISTRY.md を読んでから実装してください。」
```

---

### 3. チェックリストを活用

**実装前・実装後のチェックリストを活用することで、ミスを防ぐことができます。**

- **実装前**: 設計原則、既存コンポーネント、実装方針を確認
- **実装後**: TypeScriptエラー、動作確認、ドキュメント更新を確認

---

## まとめ

**AI実装時の必須手順:**

1. **実装前**: `DESIGN_PRINCIPLES.md` を読む
2. **実装前**: 既存コンポーネントを検索
3. **実装前**: `docs/COMPONENT_REGISTRY.md` を確認
4. **実装前**: チェックポイント1で確認
5. **実装後**: 重複チェック
6. **実装後**: `docs/COMPONENT_REGISTRY.md` を更新
7. **実装後**: チェックポイント2で報告
8. **チェックポイント前**: 設計原則・コンポーネントレジストリ・重複実装を確認

---

**最終更新**: 2026-02-04（先頭に「命令の忠実な実行と記憶の扱い」を追加し、md 準拠・記憶ドリフト防止を最優先に）
