# コンポーネント依存関係リファクタリング計画

## 目標

1. 各コンポーネントが独立してテスト可能
2. スタイルは各コンポーネントに閉じている
3. 変更の影響範囲が明確

## ベストプラクティス（調査結果）

### 採用する原則

| 原則 | 説明 | 出典 |
|------|------|------|
| **コロケーション** | スタイルはコンポーネントと同じファイルに | Thoughtbot |
| **コンポーネント再利用** | スタイルではなくコンポーネントを再利用 | Reddit（最高評価） |
| **グローバルスタイル禁止** | 共有スタイルシートは避ける | Reddit（6票） |
| **アトミックスタイル** | 複雑なスタイルは単純なスタイルから構築 | Thoughtbot |
| **汎用コンポーネント** | Typography, Card等の汎用コンポーネントを作成 | Reddit |

### 採用しない原則

| 原則 | 理由 |
|------|------|
| グローバルスタイルシート | 変更の影響範囲が不明確 |
| 複数コンポーネント間でのスタイル共有 | 依存関係が複雑化 |

## 現在の問題点と解決策

### 問題1: 巨大な共有スタイルファイル

**現状:**
```
experience-overlay/styles.ts (1,284行) → 2つのコンポーネントで共有
```

**解決策:**
```
experience-overlay/
  ├── ExperienceOverlay.tsx
  ├── ExperienceOverlay.styles.ts  # 専用スタイル
  ├── preview-content.tsx
  └── preview-content.styles.ts    # 専用スタイル
```

### 問題2: theme/tokensへの過度な依存

**現状:** 222ファイルが`@/theme/tokens`をインポート

**解決策:**
1. 色は`useColors()`フックで取得（既存）
2. スペーシング、タイポグラフィは共通定数として維持（OK）
3. コンポーネント固有のスタイルはコンポーネント内に定義

## リファクタリング手順

### Phase 1: experience-overlay（高優先度）

1. `styles.ts`の内容を分析
2. ExperienceOverlay専用のスタイルを`ExperienceOverlay.styles.ts`に移動
3. preview-content専用のスタイルを`preview-content.styles.ts`に移動
4. 共通で必要なスタイルのみ`shared.styles.ts`に残す
5. テストで動作確認

### Phase 2: japan-region

同様の手順で分割

### Phase 3: participation-form

同様の手順で分割

### Phase 4: settings

1つのコンポーネントのみで使用のため、コロケーションに変更

## 成功基準

- [ ] 各コンポーネントのスタイルが1つのファイルに閉じている
- [ ] スタイル変更時に影響を受けるファイルが1つのみ
- [ ] `grep`で依存関係を追跡可能
- [ ] テストが全てパス

## リスク軽減

1. **ブランチを切って作業** - 問題があればロールバック可能
2. **段階的に実施** - 1つのコンポーネントずつ
3. **各変更後にテスト** - 壊れたらすぐ検知
4. **チェックポイント保存** - 各フェーズ完了後
